{"version":3,"file":"index.js","sources":["../src/helpers/is/index.js","../src/core/context/reactContext.js","../src/core/context/FakeScopeContext.js","../src/core/context/index.js","../src/core/Freeze.js","../src/core/Bridge/Context/fixContext.js","../src/core/Bridge/Context/ProviderBridge.js","../src/core/Bridge/Context/ConsumerWrapper.js","../src/core/Bridge/Context/ConsumerBridge.js","../src/core/Bridge/Suspense.js","../src/core/Bridge/ErrorBoundary.js","../src/core/Bridge/index.js","../src/core/lifecycles.js","../src/core/Keeper.js","../src/core/AliveScope.js","../src/core/withAliveScope.js","../src/helpers/saveScrollPosition.js","../src/core/KeepAlive.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isRegExp = (val) => val instanceof RegExp\n// 值类型判断 -------------------------------------------------------------\n","import createContext from 'create-react-context'\n\n// 整个 KeepAlive 功能的上下文，将 KeepAlive 的组件藏于其 Provider 中，保证其不会被卸载\nexport const aliveScopeContext = createContext()\nexport const {\n  Provider: AliveScopeProvider,\n  Consumer: AliveScopeConsumer,\n} = aliveScopeContext\n\n// KeepAlive 组件的上下文，实现缓存生命周期功能\nexport const aliveNodeContext = createContext()\nexport const {\n  Provider: AliveNodeProvider,\n  Consumer: AliveNodeConsumer,\n} = aliveNodeContext\n","import { Component, PureComponent } from 'react'\nimport { EventBus, run, debounce } from 'szfe-tools'\n\nexport const eventBus = new EventBus()\n\nexport class FakeScopeProvider extends Component {\n  static eventBus = eventBus\n  static currentContextValue = undefined\n\n  constructor(props) {\n    super(props)\n    FakeScopeProvider.currentContextValue = props.value\n  }\n\n  shouldComponentUpdate(nextProps) {\n    if (nextProps.value !== this.props.value) {\n      FakeScopeProvider.currentContextValue = nextProps.value\n      eventBus.emit('update', nextProps.value)\n    }\n\n    return (\n      nextProps.children !== this.props.children ||\n      nextProps.value !== this.props.value\n    )\n  }\n\n  render() {\n    const { children } = this.props\n    return children\n  }\n}\n\nexport class FakeScopeConsumer extends PureComponent {\n  state = {\n    context: FakeScopeProvider.currentContextValue,\n  }\n\n  constructor(props) {\n    super(props)\n    eventBus.on('update', this.updateListener)\n  }\n\n  updateListener = debounce((nextContextValue) => {\n    this.setState({\n      context: nextContextValue,\n    })\n  })\n\n  componentWillUnmount() {\n    eventBus.off('update', this.updateListener)\n  }\n\n  render() {\n    const { children } = this.props\n    const { context } = this.state\n    return run(children, undefined, context)\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { useState, useContext, useEffect } from 'react'\nimport { run, debounce, isFunction } from 'szfe-tools'\n\nimport {\n  aliveScopeContext,\n  AliveScopeProvider as AliveScopeReactProvider,\n  AliveScopeConsumer as AliveScopeReactConsumer,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n} from './reactContext'\nimport {\n  eventBus as fakeContextEventBus,\n  FakeScopeProvider,\n  FakeScopeConsumer,\n} from './FakeScopeContext'\n\nexport const useScopeContext = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const scopeReactContext = useContext(aliveScopeContext)\n\n  if (scopeReactContext) {\n    return scopeReactContext\n  }\n\n  const [context, setContext] = useState(FakeScopeProvider.currentContextValue)\n\n  useEffect(() => {\n    const updateListener = debounce(setContext)\n    fakeContextEventBus.on('update', updateListener)\n    return () => fakeContextEventBus.off('update', updateListener)\n  }, [])\n\n  return context\n}\n\nexport const AliveScopeProvider = ({ children, ...props }) => (\n  <AliveScopeReactProvider {...props}>\n    <FakeScopeProvider {...props}>{children}</FakeScopeProvider>\n  </AliveScopeReactProvider>\n)\nexport const AliveScopeConsumer = ({ children }) => (\n  <AliveScopeReactConsumer>\n    {(reactContext) =>\n      !!reactContext ? (\n        run(children, undefined, reactContext)\n      ) : (\n        <FakeScopeConsumer>{children}</FakeScopeConsumer>\n      )\n    }\n  </AliveScopeReactConsumer>\n)\nexport {\n  aliveScopeContext,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n}\n","// Fork from react-freeze\r\n// https://github.com/software-mansion/react-freeze/blob/main/src/index.tsx\r\nimport React, { Component, Suspense, Fragment } from 'react'\r\n\r\n// function Suspender({ freeze, children }) {\r\n//   const promiseCache = useRef({}).current\r\n//   if (freeze && !promiseCache.promise) {\r\n//     promiseCache.promise = new Promise((resolve) => {\r\n//       promiseCache.resolve = resolve\r\n//     })\r\n//     throw promiseCache.promise\r\n//   } else if (freeze) {\r\n//     throw promiseCache.promise\r\n//   } else if (promiseCache.promise) {\r\n//     promiseCache.resolve()\r\n//     promiseCache.promise = undefined\r\n//   }\r\n\r\n//   return <Fragment>{children}</Fragment>\r\n// }\r\n\r\nclass Suspender extends Component {\r\n  promiseCache = {}\r\n  render() {\r\n    const { freeze, children } = this.props\r\n    const { promiseCache } = this\r\n\r\n    if (freeze && !promiseCache.promise) {\r\n      promiseCache.promise = new Promise((resolve) => {\r\n        promiseCache.resolve = resolve\r\n      })\r\n      throw promiseCache.promise\r\n    } else if (freeze) {\r\n      throw promiseCache.promise\r\n    } else if (promiseCache.promise) {\r\n      promiseCache.resolve()\r\n      promiseCache.promise = undefined\r\n    }\r\n\r\n    return <Fragment>{children}</Fragment>\r\n  }\r\n}\r\n\r\nexport default function Freeze({ freeze, children, placeholder = null }) {\r\n  return (\r\n    <Suspense fallback={placeholder}>\r\n      <Suspender freeze={freeze}>{children}</Suspender>\r\n    </Suspense>\r\n  )\r\n}","import React from 'react'\nimport createReactContext from 'create-react-context'\nimport { get, isString, isFunction, memoize, EventBus, isExist } from 'szfe-tools'\n\nimport { aliveScopeContext, aliveNodeContext } from '../../context'\n\nexport const fixedContext = []\nexport const updateListenerCache = new Map()\nexport const eventBus = new EventBus()\n\nexport const fixContext = memoize((ctx) => {\n  if (!isExist(ctx)) {\n    return\n  }\n\n  // 排除 KeepAlive 功能的上下文\n  if ([aliveScopeContext, aliveNodeContext].includes(ctx)) {\n    return\n  }\n  fixedContext.push(ctx)\n  setTimeout(() => eventBus.emit('update'))\n})\n\nexport const createContext = (defaultValue, calculateChangedBits) => {\n  const ctx = createReactContext(defaultValue, calculateChangedBits)\n\n  fixContext(ctx)\n  return ctx\n}\n\nconst tryFixCtx = memoize((type) => {\n  // 尝试读取 Provider 或 Consumer 中的 context 静态属性\n  const ctx = get(type, '_context') || get(type, 'context') // 16.3.0 版本为 context，之后为 _context\n\n  // 判断是否为 ReactContext 类型\n  if (get(ctx, '$$typeof') === get(aliveScopeContext, '$$typeof')) {\n    fixContext(ctx)\n  }\n})\n\nconst override = (configs) => {\n  configs.forEach(([host, ...methods]) => {\n    methods.forEach((method) => {\n      if (\n        !isFunction(get(host, method)) ||\n        get(host, [method, '_overridden'])\n      ) {\n        return\n      }\n      const originMethod = host[method].bind(host)\n      host[method] = (type, ...args) => {\n        if (!isString(type)) {\n          tryFixCtx(type)\n        }\n        return originMethod(type, ...args)\n      }\n      host[method]._overridden = true\n    })\n  })\n}\n\n/**\n * 通过覆写 React.createElement 方法来探测 Provider 或 Consumer 的创建，并攫取其中 context 主动进行修复\n * TODO：同时兼容 React 17+，目前仅默认兼容 React.createElement 方法\n * React 17+ 为 require('react/jsx-runtime') 或 require('react/jsx-dev-runtime') 的 jsx、jsxs、jsxDEV 方法\n * 但由于无法动态 require，暂未想到方式同时兼容\n * 若需兼容 17+，目前手法为\n *\n * autoFixContext(\n *   [require('react/jsx-runtime'), 'jsx', 'jsxs', 'jsxDEV'],\n *   [require('react/jsx-dev-runtime'), 'jsx', 'jsxs', 'jsxDEV']\n * )\n *\n * Note: 需注意 16.2.x 及以下版本不支持此方法\n */\nexport const autoFixContext = (...configs) => {\n  try {\n    override(configs)\n  } catch (err) {\n    console.warn('activation override failed:', err)\n  }\n}\n\nautoFixContext([React, 'createElement'])\n","import React, { PureComponent } from 'react'\nimport { run, isUndefined } from 'szfe-tools'\n\nexport default class ProviderBridge extends PureComponent {\n  unmount = null\n  constructor(props) {\n    super(props)\n\n    const { value: ctxValues } = props\n\n    if (ctxValues.length === 0) {\n      this.state = {\n        ctxValue: null,\n      }\n\n      return\n    }\n\n    const [{ ctx, value, onUpdate }] = ctxValues\n\n    this.state = {\n      ctxValue: value,\n    }\n\n    this.unmount = onUpdate((value) => {\n      this.setState({\n        ctxValue: value,\n      })\n    })\n  }\n\n  componentWillUnmount() {\n    run(this.unmount)\n  }\n\n  // componentDidCatch(error) {\n  //   console.error('ProviderBridge Error', error)\n  // }\n\n  render() {\n    const { value: ctxValues, children } = this.props\n\n    if (ctxValues.length === 0) {\n      return children\n    }\n\n    const { ctxValue } = this.state\n    const [{ ctx }, ...restValues] = ctxValues\n    const { Provider } = ctx\n\n    const nextChildren = !isUndefined(ctxValue) ? (\n      <Provider value={ctxValue}>{children}</Provider>\n    ) : (\n      children\n    )\n\n    // 递归 ProviderBridge 修复多个上下文\n    // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n    return restValues.length > 0 ? (\n      <ProviderBridge value={restValues}>{nextChildren}</ProviderBridge>\n    ) : (\n      nextChildren\n    )\n  }\n}\n","import { Component } from 'react'\nimport { run, get, isUndefined } from 'szfe-tools'\n\nimport { updateListenerCache } from './fixContext'\n\n// 在 KeepAlive 位置使用待修复上下文的 Consumer 探测可能存在的上下文关系\n// 若成功捕获上下文则保存其内容，用以后续 Keeper 中上下文的重建\nexport default class ConsumerWrapper extends Component {\n  updateListener = null\n  ctxInfo = null\n  constructor(props) {\n    super(props)\n\n    const { value, ctx, id } = props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    this.updateListener = get(updateListenerCache.get(ctx), id, new Map())\n    run(this.updateListener, 'forEach', (fn) => fn(value))\n    this.ctxInfo = {\n      ctx,\n      value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: (updator) => {\n        this.updateListener.set(updator, updator)\n\n        // 返回更新监听器的注销方法\n        return () => this.updateListener.delete(updator)\n      },\n    }\n  }\n\n  componentWillUnmount() {\n    const { value, ctx, id } = this.props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n    updateListenerCache.set(ctx, {\n      ...get(updateListenerCache.get(ctx), undefined, {}),\n      [id]: this.updateListener,\n    })\n  }\n\n  // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n  // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  shouldComponentUpdate({ value }) {\n    const { value: prevValue } = this.props\n    const shouldUpdate = prevValue !== value\n\n    if (shouldUpdate) {\n      run(this.updateListener, 'forEach', (fn) => fn(value))\n    }\n\n    return shouldUpdate\n  }\n\n  render() {\n    const { value, renderWrapper, renderContent, id } = this.props\n\n    return renderWrapper((ctx$$) =>\n      renderContent(isUndefined(value) ? ctx$$ : [...ctx$$, this.ctxInfo])\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  PureComponent,\n  useContext,\n  useRef,\n  useEffect,\n  useState,\n} from 'react'\nimport { run, get, nextTick, isUndefined, isFunction } from 'szfe-tools'\n\nimport ConsumerWrapper from './ConsumerWrapper'\nimport { fixedContext, eventBus, updateListenerCache } from './fixContext'\n\nconst fixedContextSnapshot = {}\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nclass RecursiveConsumerBridge extends PureComponent {\n  constructor(props) {\n    super(props)\n    const { id } = props\n\n    if (!fixedContextSnapshot[id]) {\n      fixedContextSnapshot[id] = [...fixedContext]\n    }\n  }\n\n  renderWrapper = (renderChildren) => {\n    const { id } = this.props\n\n    const renderWrapper = fixedContextSnapshot[id].reduce(\n      (render, ctx) => {\n        const { Consumer } = ctx\n\n        const renderWrapper = (renderContent) => (\n          <Consumer>\n            {(value) => (\n              <ConsumerWrapper\n                {...{\n                  value,\n                  ctx,\n                  renderWrapper: render,\n                  renderContent,\n                  id,\n                }}\n              />\n            )}\n          </Consumer>\n        )\n\n        return renderWrapper\n      },\n      (renderContent) => renderContent([])\n    )\n\n    return renderWrapper(renderChildren)\n  }\n\n  render() {\n    const { children: renderChildren } = this.props\n\n    return this.renderWrapper(renderChildren)\n  }\n}\n\n// 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\n// function HooksConsumerBridge({ children: renderChildren, id }) {\n//   const [, setRenderKey] = useState(Math.random)\n\n//   useEffect(() => {\n//     // 渲染时若 fixedContext 列表更新，则需强制刷新\n//     const updateListener = () => setRenderKey(Math.random)\n//     eventBus.on('update', updateListener)\n//     return () => {\n//       eventBus.off('update', updateListener)\n//     }\n//   }, [])\n\n//   const context$$ = fixedContext\n//     .map((ctx) => {\n//       const value = useContext(ctx)\n//       const prevValueRef = useRef(value)\n//       const { current: updateListener } = useRef(\n//         get(updateListenerCache.get(ctx), id, new Map())\n//       )\n\n//       // 尽可能早地进行更新\n//       if (prevValueRef.current !== value) {\n//         nextTick(() => run(updateListener, 'forEach', (fn) => fn(value)))\n//       }\n//       prevValueRef.current = value\n\n//       useEffect(() => {\n//         return () => {\n//           if (isUndefined(value)) {\n//             return\n//           }\n\n//           updateListenerCache.set(ctx, {\n//             ...get(updateListenerCache.get(ctx), undefined, {}),\n//             [id]: updateListener,\n//           })\n//         }\n//       }, [])\n\n//       return {\n//         ctx,\n//         value,\n//         onUpdate: (fn) => {\n//           updateListener.set(fn, fn)\n\n//           return () => updateListener.delete(fn)\n//         },\n//       }\n//     })\n//     .filter(({ value }) => !isUndefined(value))\n\n//   return renderChildren(context$$)\n// }\n\n// fix #99\n// const ConsumerBridge = [useContext, useRef, useEffect].every(isFunction)\n//   ? HooksConsumerBridge\n//   : RecursiveConsumerBridge\n// fix #99\nexport default RecursiveConsumerBridge\n","import React, { lazy, Suspense, Component, Fragment } from 'react'\nimport { run, isUndefined, isFunction } from 'szfe-tools'\n\n// 兼容性检测\nconst isSupported = isFunction(lazy) && !isUndefined(Suspense)\nconst SusNotSupported = ({ children }) => run(children)\n\nconst Lazy = isSupported ? lazy(() => new Promise(() => null)) : () => null\n\nclass FallbackListener extends Component {\n  componentDidMount() {\n    run(this.props, 'onStart')\n  }\n\n  componentWillUnmount() {\n    run(this.props, 'onEnd')\n  }\n\n  render() {\n    return null\n  }\n}\n\nfunction SuspenseBridge({ children, sus$$ }) {\n  return (\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    <Suspense\n      fallback={\n        <FallbackListener\n          onStart={sus$$.onSuspenseStart}\n          onEnd={sus$$.onSuspenseEnd}\n        />\n      }\n    >\n      {children}\n    </Suspense>\n  )\n}\n\nexport const LazyBridge = isSupported\n  ? class LazyBridge extends Component {\n      state = {\n        suspense: false,\n      }\n\n      onSuspenseStart = () => {\n        this.setState({\n          suspense: true,\n        })\n      }\n\n      onSuspenseEnd = () => {\n        this.setState({\n          suspense: false,\n        })\n      }\n\n      sus$$ = {\n        onSuspenseStart: this.onSuspenseStart,\n        onSuspenseEnd: this.onSuspenseEnd,\n      }\n\n      render() {\n        const { children } = this.props\n\n        return (\n          <Fragment>\n            {run(children, undefined, this.sus$$)}\n            {/* 渲染 Lazy 以触发 KeepAlive 所处位置外部可能存在的 Suspense */}\n            {this.state.suspense && <Lazy />}\n          </Fragment>\n        )\n      }\n    }\n  : SusNotSupported\n\nexport default isSupported ? SuspenseBridge : SusNotSupported\n","import { Component } from 'react'\nimport { run } from 'szfe-tools'\n\nexport default class ErrorBoundaryBridge extends Component {\n  // Error Boundary 透传至对应 KeepAlive 实例位置\n  static getDerivedStateFromError = () => null\n  componentDidCatch(error) {\n    const { error$$: throwError } = this.props\n\n    run(throwError, undefined, error, () => {\n      run(throwError, undefined, null)\n    })\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport class ErrorThrower extends Component {\n  state = {\n    error: null,\n  }\n\n  throwError = (error, cb) => this.setState({ error }, cb)\n  render() {\n    if (this.state.error) {\n      throw this.state.error\n    }\n\n    return run(this.props.children, undefined, this.throwError)\n  }\n}\n","import React from 'react'\nimport { run } from 'szfe-tools'\n\nimport { ProviderBridge, ConsumerBridge } from './Context'\nimport SuspenseBridge, { LazyBridge } from './Suspense'\nimport ErrorBoundaryBridge, { ErrorThrower } from './ErrorBoundary'\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nexport default function Bridge({ id, children, bridgeProps }) {\n  const { sus$$, ctx$$, error$$ } = bridgeProps\n\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorBoundaryBridge error$$={error$$}>\n      {/* 由内向外透传 lazy 行为 */}\n      <SuspenseBridge sus$$={sus$$}>\n        {/* 由外向内透传可能存在的 Consumer 数据 */}\n        <ProviderBridge id={id} value={ctx$$}>\n          {children}\n        </ProviderBridge>\n      </SuspenseBridge>\n    </ErrorBoundaryBridge>\n  )\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nexport function Acceptor({ id, children }) {\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorThrower>\n      {(error$$) => (\n        /* 由内向外透传 lazy 行为 */\n        <LazyBridge>\n          {(sus$$) => (\n            /* 由外向内透传可能被捕获的 Provider 数据 */\n            <ConsumerBridge id={id}>\n              {(ctx$$) =>\n                run(children, undefined, {\n                  bridgeProps: {\n                    sus$$,\n                    ctx$$,\n                    error$$,\n                  },\n                })\n              }\n            </ConsumerBridge>\n          )}\n        </LazyBridge>\n      )}\n    </ErrorThrower>\n  )\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  Component,\n  forwardRef,\n  useEffect,\n  useRef,\n  useContext,\n} from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport {\n  get,\n  run,\n  nextTick,\n  isObject,\n  isFunction,\n  isUndefined,\n} from 'szfe-tools'\n\nimport { AliveNodeConsumer, aliveNodeContext } from './context'\n\nexport const LIFECYCLE_ACTIVATE = 'componentDidActivate'\nexport const LIFECYCLE_UNACTIVATE = 'componentWillUnactivate'\n\nexport const withActivation = (WrappedComponent) => {\n  class HOC extends Component {\n    drop = null\n\n    componentWillUnmount() {\n      run(this.drop)\n    }\n\n    render() {\n      const { forwardedRef, ...props } = this.props\n\n      return (\n        <AliveNodeConsumer>\n          {({ attach } = {}) => (\n            <WrappedComponent\n              ref={(ref) => {\n                if (\n                  [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(\n                    (lifecycleName) => !isFunction(get(ref, lifecycleName))\n                  )\n                ) {\n                  return\n                }\n                this.drop = run(attach, undefined, ref)\n\n                // 以下保持 ref 功能\n                if (isUndefined(forwardedRef)) {\n                  return\n                }\n\n                if (isObject(forwardedRef) && 'current' in forwardedRef) {\n                  forwardedRef.current = ref\n                  return\n                }\n\n                run(forwardedRef, undefined, ref)\n              }}\n              {...props}\n            />\n          )}\n        </AliveNodeConsumer>\n      )\n    }\n  }\n\n  // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n\n  if (isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount =\n      WrappedComponent.prototype.componentDidMount\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      nextTick(() => WrappedComponent.prototype._componentDidMount.call(this))\n    }\n  }\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOC {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOC, WrappedComponent)\n  }\n}\n\nconst useActivation = (funcName, func) => {\n  // 兼容性判断\n  if ([useRef, useContext, useEffect].some((fn) => !isFunction(fn))) {\n    return\n  }\n\n  const ctxValue = useContext(aliveNodeContext)\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return\n  }\n\n  const { current: ref } = useRef({})\n  const { attach } = ctxValue\n\n  ref[funcName] = func\n  ref.drop = attach(ref)\n\n  useEffect(() => {\n    return () => run(ref.drop)\n  }, [])\n}\n\nexport const useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE)\nexport const useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE)\n","import React, { PureComponent, Suspense } from 'react'\nimport { get, run, nextTick, EventBus } from 'szfe-tools'\n\nimport ReactFreeze from './Freeze'\nimport Bridge from './Bridge'\nimport { AliveNodeProvider } from './context'\nimport { LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE } from './lifecycles'\n\nconst Freeze = !!Suspense ? ReactFreeze : ({ children }) => children\n\nexport default class Keeper extends PureComponent {\n  eventBus = new EventBus()\n  listeners = new Map()\n  wrapper = null\n\n  constructor(props, ...rest) {\n    super(props, ...rest)\n\n    this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n      freeze: false,\n    }\n  }\n\n  cache = undefined\n  componentDidMount() {\n    const { store, id } = this.props\n    const listeners = this.listeners\n    const node = this.wrapper\n\n    // 已存在检测，防止意外现象\n    if (store.has(id)) {\n      return\n    }\n\n    let nodes\n    try {\n      nodes = [...node.children]\n    } catch (e) {\n      nodes = [node.children]\n    }\n\n    this.cache = {\n      listeners,\n      aliveNodesId: [],\n      inited: false,\n      cached: false,\n      wrapper: node,\n      nodes,\n      [LIFECYCLE_ACTIVATE]: () => this[LIFECYCLE_ACTIVATE](),\n      [LIFECYCLE_UNACTIVATE]: () => this[LIFECYCLE_UNACTIVATE](),\n    }\n\n    store.set(id, this.cache)\n  }\n\n  \n  unmounted = false\n  safeSetState = (nextState, callback) => {\n    // fix #170\n    if (this.unmounted) {\n      return\n    }\n    this.setState(nextState, callback)\n  }\n  componentWillUnmount() {\n    const { store, keepers, id } = this.props\n    // 卸载前尝试归位 DOM 节点\n    try {\n      const cache = store.get(id)\n      cache.nodes.forEach((node) => {\n        cache.wrapper.appendChild(node)\n      })\n    } catch (error) {\n      // console.error(error) // do nothing\n    }\n    store.delete(id)\n    keepers.delete(id)\n    this.unmounted = true\n  }\n\n  freezeTimeout = null\n\n  ;[LIFECYCLE_ACTIVATE]() {\n    clearTimeout(this.freezeTimeout)\n    // 激活后，立即解冻\n    this.safeSetState({\n      freeze: false,\n    })\n    this.eventBus.emit(LIFECYCLE_ACTIVATE)\n    this.listeners.forEach((listener) => run(listener, [LIFECYCLE_ACTIVATE]))\n  }\n\n  ;[LIFECYCLE_UNACTIVATE]() {\n    this.eventBus.emit(LIFECYCLE_UNACTIVATE)\n    const listeners = [...this.listeners]\n\n    listeners\n      .reverse()\n      .forEach(([, listener]) => run(listener, [LIFECYCLE_UNACTIVATE]))\n\n    // 缓存后，延迟冻结，保证各项后续处理得以进行，如关闭弹窗等\n    clearTimeout(this.freezeTimeout)\n    this.freezeTimeout = setTimeout(() => {\n      this.safeSetState({\n        freeze: true,\n      })\n    }, 1000)\n  }\n\n  // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n  // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n  // // 对应 KeepAlive 处 update 也注释起来不使用\n  // // 组件更新后，更新 DOM 节点列表状态\n  // componentDidUpdate() {\n  //   const { store, id } = this.props\n  //   const node = this.wrapper\n  //   if (get(node, 'children.length') > 0) {\n  //     store[id].nodes = [...node.children]\n  //   }\n\n  //   console.log(store[id].nodes)\n  // }\n\n  // 生命周期绑定\n  attach = (ref) => {\n    const listeners = this.listeners\n\n    if (!ref) {\n      return () => null\n    }\n\n    if (ref.isKeepAlive) {\n      nextTick(() => {\n        const { id, store } = this.props\n        const cache = store.get(id)\n        cache.aliveNodesId = new Set([...cache.aliveNodesId, ref.id])\n      })\n    }\n\n    listeners.set(ref, {\n      [LIFECYCLE_ACTIVATE]: () => run(ref, LIFECYCLE_ACTIVATE),\n      [LIFECYCLE_UNACTIVATE]: () => run(ref, LIFECYCLE_UNACTIVATE),\n    })\n\n    // 返回 listenerRemover 用以在对应组件卸载时解除监听\n    return () => {\n      listeners.delete(ref)\n    }\n  }\n\n  // 静态化节点上下文内容，防止重复渲染\n  contextValue = {\n    id: this.props.id,\n    attach: this.attach,\n  }\n\n  drop = ({ delay = 1200 } = {}) =>\n    new Promise((resolve) => {\n      let timeout\n      const { scope, id } = this.props\n      const drop = () => {\n        clearTimeout(timeout)\n        this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n        // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n        this.cache.willDrop = true\n        scope.nodes.delete(id)\n        scope.helpers = { ...scope.helpers }\n        scope.smartForceUpdate(() => resolve(true))\n      }\n\n      const canDrop = get(this.cache, 'cached') || get(this.cache, 'willDrop')\n      if (!canDrop) {\n        this.eventBus.on(LIFECYCLE_UNACTIVATE, drop)\n        timeout = setTimeout(() => {\n          this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n          resolve(false)\n        }, delay)\n        return\n      }\n\n      drop()\n    })\n\n  refresh = () =>\n    new Promise((resolve) => {\n      const canRefresh = !get(this.cache, 'cached')\n      if (!canRefresh) {\n        resolve(false)\n      }\n      this.safeSetState(\n        {\n          key: Math.random(),\n        },\n        () => resolve(true)\n      )\n    })\n\n  render() {\n    const { id, ...props } = this.props\n    const { children, bridgeProps, key, freeze } = this.state\n\n    return (\n      <Freeze freeze={freeze}>\n        <div\n          ref={(node) => {\n            this.wrapper = node\n          }}\n        >\n          <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n            <Bridge id={id} bridgeProps={bridgeProps}>\n              <AliveNodeProvider value={this.contextValue}>\n                {React.Children.map(children, (child, idx) =>\n                  React.cloneElement(child, {\n                    key: `${child.key || ''}:${key}:${idx}`,\n                  })\n                )}\n              </AliveNodeProvider>\n            </Bridge>\n          </div>\n        </div>\n      </Freeze>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport ReactDOM from 'react-dom'\nimport { get, run, flatten, debounce, globalThis as root } from 'szfe-tools'\n\nimport { isRegExp } from '../helpers/is'\nimport { AliveScopeProvider } from './context'\nimport Keeper from './Keeper'\n\nconst HANDLE_TYPE_DROP = 'drop'\nconst HANDLE_TYPE_REFRESH = 'refresh'\n\nexport default class AliveScope extends Component {\n  store = new Map()\n  nodes = new Map()\n  keepers = new Map()\n\n  debouncedForceUpdate = debounce((cb) => this.forceUpdate(cb))\n  updateCallbackList = []\n  smartForceUpdate = (cb) => {\n    this.updateCallbackList.push(cb)\n    this.debouncedForceUpdate(() => {\n      this.updateCallbackList.forEach((cb) => run(cb))\n      this.updateCallbackList = []\n    })\n  }\n  update = (id, params) =>\n    new Promise((resolve) => {\n      const keeper = this.keepers.get(id)\n      const isNew = !keeper\n      const now = Date.now()\n      const node = this.nodes.get(id) || null\n      this.nodes.set(id, {\n        id,\n        createTime: now,\n        updateTime: now,\n        ...node,\n        ...params,\n      })\n\n      if (isNew) {\n        this.helpers = { ...this.helpers }\n\n        this.forceUpdate(resolve)\n      } else {\n        const { children, bridgeProps } = params\n        keeper.setState({ children, bridgeProps }, resolve)\n      }\n    })\n\n  keep = (id, params) =>\n    new Promise((resolve) => {\n      this.update(id, {\n        id,\n        ...params,\n      }).then(() => {\n        resolve(this.store.get(id))\n      })\n    })\n\n  getCachingNodesByName = (name) =>\n    this.getCachingNodes().filter((node) =>\n      isRegExp(name) ? name.test(node.name) : node.name === name\n    )\n\n  getScopeIds = (ids) => {\n    // 递归采集 scope alive nodes id\n    const getCachingNodesId = (id) => {\n      const aliveNodesId = get(this.getCache(id), 'aliveNodesId', [])\n\n      if (aliveNodesId.size > 0) {\n        return [id, [...aliveNodesId].map(getCachingNodesId)]\n      }\n\n      return [id, ...aliveNodesId]\n    }\n\n    return flatten(ids.map((id) => getCachingNodesId(id)))\n  }\n\n  dropById = (id, ...rest) => this.handleNodes([id], HANDLE_TYPE_DROP, ...rest)\n  dropScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_DROP, ...rest)\n\n  drop = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  dropScope = (name, ...rest) =>\n    this.dropScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  refreshById = (id, ...rest) =>\n    this.handleNodes([id], HANDLE_TYPE_REFRESH, ...rest)\n  refreshScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_REFRESH, ...rest)\n\n  refresh = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_REFRESH,\n      ...rest\n    )\n\n  refreshScope = (name, ...rest) =>\n    this.refreshScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  handleNodes = (nodesId, type = HANDLE_TYPE_DROP, ...rest) =>\n    new Promise((resolve) => {\n      const handleKeepers = []\n\n      nodesId.forEach((id) => {\n        const cache = this.store.get(id)\n\n        if (!cache) {\n          return\n        }\n\n        const keeper = this.keepers.get(id)\n        handleKeepers.push(keeper)\n      })\n\n      if (handleKeepers.length === 0) {\n        resolve(false)\n        return\n      }\n\n      Promise.all(\n        handleKeepers.map((keeper) => run(keeper, type, ...rest))\n      ).then((responses) => resolve(responses.every(Boolean)))\n    })\n\n  clear = (...rest) =>\n    this.handleNodes(\n      this.getCachingNodes().map(({ id }) => id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  getCache = (id) => this.store.get(id)\n  getNode = (id) => this.nodes.get(id)\n  getCachingNodes = () => [...this.nodes.values()]\n\n  // 静态化节点上下文内容，防止重复渲染\n  helpers = {\n    keep: this.keep,\n    update: this.update,\n    drop: this.drop,\n    dropScope: this.dropScope,\n    dropById: this.dropById,\n    dropScopeByIds: this.dropScopeByIds,\n    refresh: this.refresh,\n    refreshScope: this.refreshScope,\n    refreshById: this.refreshById,\n    refreshScopeByIds: this.refreshScopeByIds,\n    getScopeIds: this.getScopeIds,\n    clear: this.clear,\n    getCache: this.getCache,\n    getNode: this.getNode,\n    getCachingNodes: this.getCachingNodes,\n  }\n\n  render() {\n    const { children = null } = this.props\n\n    return (\n      <AliveScopeProvider value={this.helpers}>\n        {children}\n        <div style={{ display: 'none' }}>\n          {[...this.nodes.values()].map(({ children, ...props }) => (\n            <Keeper\n              key={props.id}\n              {...props}\n              scope={this}\n              store={this.store}\n              keepers={this.keepers}\n              ref={(keeper) => {\n                this.keepers.set(props.id, keeper)\n              }}\n            >\n              {children}\n            </Keeper>\n          ))}\n        </div>\n      </AliveScopeProvider>\n    )\n  }\n}\n\nfunction renderDefaultScope() {\n  if (!get(root, 'document')) {\n    return\n  }\n  const container = run(root, 'document.createElement', 'div')\n  // compatible with react 18\n  if (ReactDOM.createRoot) ReactDOM.createRoot(container).render(<AliveScope />)\n  else ReactDOM.render(<AliveScope />, container)\n}\nrenderDefaultScope()\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { forwardRef, useContext } from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { get, isFunction, isUndefined } from 'szfe-tools'\n\nimport { Acceptor } from './Bridge'\nimport NodeKey from './NodeKey'\nimport { AliveScopeConsumer, useScopeContext } from './context'\n\nfunction controllerCherryPick(controller) {\n  const {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n  } = controller\n  return { drop, dropScope, refresh, refreshScope, clear, getCachingNodes }\n}\n\nexport const expandKeepAlive = (KeepAlive) => {\n  const renderContent = ({ idPrefix, helpers, props }) => {\n    const isOutsideAliveScope = isUndefined(helpers)\n\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>')\n    }\n\n    return isOutsideAliveScope ? (\n      get(props, 'children', null)\n    ) : (\n      <NodeKey prefix={idPrefix} key={props._nk}>\n        {(id) => (\n          <Acceptor key={id} id={id}>\n            {(bridgeProps) => (\n              <KeepAlive\n                key={id}\n                {...props}\n                {...bridgeProps}\n                id={id}\n                _helpers={helpers}\n              />\n            )}\n          </Acceptor>\n        )}\n      </NodeKey>\n    )\n  }\n  const HookExpand = ({ id: idPrefix, ...props }) =>\n    renderContent({ idPrefix, helpers: useScopeContext(), props })\n\n  const WithExpand = ({ id: idPrefix, ...props }) => (\n    <AliveScopeConsumer>\n      {(helpers) => renderContent({ idPrefix, helpers, props })}\n    </AliveScopeConsumer>\n  )\n\n  return isFunction(useContext) ? HookExpand : WithExpand\n}\n\nconst withAliveScope = (WrappedComponent) => {\n  const renderContent = ({ helpers, props, forwardedRef }) => (\n    <WrappedComponent {...props} {...helpers} ref={forwardedRef} />\n  )\n\n  const HookScope = ({ forwardedRef, ...props }) =>\n    renderContent({\n      helpers: controllerCherryPick(useScopeContext() || {}),\n      props,\n      forwardedRef,\n    })\n\n  const WithScope = ({ forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(controller = {}) =>\n        renderContent({\n          helpers: controllerCherryPick(controller),\n          props,\n          forwardedRef,\n        })\n      }\n    </AliveScopeConsumer>\n  )\n\n  const HOCWithAliveScope = isFunction(useContext) ? HookScope : WithScope\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOCWithAliveScope {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent)\n  }\n}\n\nexport const useAliveController = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const ctxValue = useScopeContext()\n\n  if (!ctxValue) {\n    return {}\n  }\n\n  return controllerCherryPick(ctxValue)\n}\n\nexport default withAliveScope\n","import {\n  globalThis as root,\n  get,\n  run,\n  value,\n  isFunction,\n  isExist,\n  flatten,\n} from 'szfe-tools'\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.querySelectorAll'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [...new Set([...flatten(from.map(getScrollableNodes))])]\n\n  const saver = nodes.map((node) => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop,\n    },\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import React, { Component } from 'react'\nimport {\n  value,\n  get,\n  run,\n  globalThis as root,\n  nextTick,\n  isFunction,\n  isArray,\n  debounce,\n  flatten,\n} from 'szfe-tools'\n\nimport { expandKeepAlive } from './withAliveScope'\nimport {\n  LIFECYCLE_ACTIVATE,\n  LIFECYCLE_UNACTIVATE,\n  withActivation,\n} from './lifecycles'\nimport saveScrollPosition from '../helpers/saveScrollPosition'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nconst getErrorTips = (name) =>\n  `<KeepAlive ${\n    name ? `name=\"${name}\" ` : ''\n  }/> Too many transient updates, may have encountered an infinite loop of updates, forced to pause the update\nThere are serious performance issues with the update results you are currently seeing\nMay encounter an implied bug, please don't use KeepAlive and contact the author to solve`\n\nconst parseWhenResult = (res) => {\n  if (isArray(res)) {\n    return res\n  }\n\n  return [res]\n}\n\nclass KeepAlive extends Component {\n  static defaultProps = {\n    saveScrollPosition: true,\n  }\n  // 本段为 KeepAlive 更新隐患检测，通过检测 KeepAlive 瞬时更新次数来判断是否进入死循环，并在 update 中强制阻止更新\n  updateTimes = 0\n  errorTips = debounce(() => {\n    const { name } = this.props\n    console.error(getErrorTips(name))\n  }, 100)\n  releaseUpdateTimes = debounce(() => {\n    this.updateTimes = 0\n  }, 16)\n  needForceStopUpdate = () => {\n    const needForceStopUpdate = this.updateTimes > 64\n\n    if (needForceStopUpdate) {\n      this.errorTips()\n    }\n\n    this.updateTimes++\n    this.releaseUpdateTimes()\n\n    return needForceStopUpdate\n  }\n\n  id = null // 用作 Keeper 识别 KeepAlive\n  isKeepAlive = true // 用作 Keeper 识别 KeepAlive\n  cached = false\n  constructor(props) {\n    super(props)\n    this.id = props.id\n    this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;[LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach((lifecycleName) => {\n      this[lifecycleName] = () => {\n        const { id, _helpers } = this.props\n        const cache = _helpers.getCache(id)\n        const node = _helpers.getNode(id)\n        if (node && lifecycleName === LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now()\n        }\n\n        const cached = lifecycleName === LIFECYCLE_UNACTIVATE\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (this.cached && !cached) {\n            this.init()\n          }\n          return\n        }\n\n        run(cache, lifecycleName)\n        cache.cached = cached\n        this.cached = cached\n      }\n    })\n  }\n\n  // DOM 操作将实际内容插入占位元素\n  inject = (didActivate = true) => {\n    const { id, saveScrollPosition, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    // DOM 操作有风险，try catch 护体\n    try {\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode = this.placeholder.parentNode\n      // cache.nodes.forEach(node => {\n      //   this.parentNode.insertBefore(node, this.placeholder)\n      // })\n      // this.parentNode.removeChild(this.placeholder)\n      // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n      cache.nodes.forEach((node) => {\n        this.placeholder.appendChild(node)\n      })\n\n      if (didActivate && saveScrollPosition) {\n        // 恢复该节点下各可滚动元素的滚动位置\n        run(cache.revertScrollPos)\n      }\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  // DOM 操作将实际内容移出占位元素\n  eject = (willUnactivate = true) => {\n    const { id, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    const nodesNeedToSaveScrollPosition = flatten(\n      flatten([this.props.saveScrollPosition]).map((flag) => {\n        if (flag === true) {\n          return cache.nodes\n        }\n\n        if (flag === 'screen') {\n          return [screenScrollingElement, body]\n        }\n\n        return [...value(run(root, 'document.querySelectorAll', flag), [])]\n      })\n    ).filter(Boolean)\n\n    // DOM 操作有风险，try catch 护体\n    try {\n      if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n        // 保存该节点下各可滚动元素的滚动位置\n        cache.revertScrollPos = saveScrollPosition(\n          nodesNeedToSaveScrollPosition\n        )\n      }\n\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // cache.nodes.forEach(node => {\n      //   if (willUnactivate) {\n      //     this.parentNode.removeChild(node)\n      //   } else {\n      //     cache.wrapper.appendChild(node)\n      //   }\n      // })\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n      cache.nodes.forEach((node) => {\n        if (willUnactivate) {\n          this.placeholder.removeChild(node)\n        } else {\n          cache.wrapper.appendChild(node)\n        }\n      })\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  init = () => {\n    const { _helpers, id, children, ...rest } = this.props\n\n    // 将 children 渲染至 AliveScopeProvider 中\n    _helpers\n      .keep(id, {\n        children,\n        getInstance: () => this,\n        ...rest,\n      })\n      .then((cache) => {\n        // fix #22\n        if (!cache) {\n          return\n        }\n\n        this.inject()\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          run(this, LIFECYCLE_ACTIVATE)\n        } else {\n          cache.inited = true\n        }\n        this.cached = false\n      })\n  }\n\n  update = ({ _helpers, id, name, ...rest } = {}) => {\n    if (!_helpers || this.cached || this.needForceStopUpdate(name)) {\n      return\n    }\n\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n    // this.eject(false)\n    _helpers.update(id, {\n      name,\n      getInstance: () => this,\n      ...rest,\n    })\n    // this.inject(false)\n  }\n\n  // 利用 shouldComponentUpdate 提前触发组件更新\n  shouldComponentUpdate(nextProps) {\n    this.update(nextProps)\n\n    return false\n  }\n\n  // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  componentWillUnmount() {\n    const { id, _helpers, when: calcWhen = true } = this.props\n    const cache = _helpers.getCache(id)\n    const [when, isScope] = parseWhenResult(run(calcWhen))\n\n    if (!cache) {\n      return\n    }\n\n    this.eject()\n    delete cache.getInstance\n\n    if (!when) {\n      if (isScope) {\n        const needToDrop = [\n          cache,\n          ..._helpers.getScopeIds([id]).map((id) => _helpers.getCache(id)),\n        ].filter(Boolean)\n\n        needToDrop.forEach((cache) => {\n          cache.willDrop = true\n        })\n        nextTick(() => _helpers.dropScopeByIds([id]))\n      } else {\n        cache.willDrop = true\n        nextTick(() => _helpers.dropById(id))\n      }\n    }\n\n    // 触发 willUnactivate 生命周期\n    run(this, LIFECYCLE_UNACTIVATE)\n  }\n\n  render() {\n    return (\n      <div\n        key=\"keep-alive-placeholder\"\n        nodeKeyIgnore\n        className=\"ka-wrapper\"\n        ref={(node) => {\n          this.placeholder = node\n        }}\n      />\n    )\n  }\n}\n\n// 兼容 SSR 服务端渲染\nfunction SSRKeepAlive({ children }) {\n  return (\n    <div key=\"keep-alive-placeholder\" nodeKeyIgnore className=\"ka-wrapper\">\n      <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default isFunction(get(root, 'document.getElementById'))\n  ? expandKeepAlive(withActivation(KeepAlive))\n  : SSRKeepAlive\n"],"names":["isRegExp","val","RegExp","aliveScopeContext","createContext","AliveScopeProvider","Provider","AliveScopeConsumer","Consumer","aliveNodeContext","AliveNodeProvider","AliveNodeConsumer","eventBus","FakeScopeProvider","props","currentContextValue","value","nextProps","emit","children","Component","undefined","FakeScopeConsumer","context","nextContextValue","setState","on","updateListener","off","state","PureComponent","useScopeContext","useContext","scopeReactContext","useState","setContext","useEffect","fakeContextEventBus","React","AliveScopeReactProvider","AliveScopeReactConsumer","reactContext","Suspender","freeze","promiseCache","promise","Promise","resolve","Fragment","Freeze","placeholder","Suspense","fixedContext","updateListenerCache","Map","fixContext","ctx","includes","push","setTimeout","defaultValue","calculateChangedBits","createReactContext","tryFixCtx","type","override","configs","forEach","host","methods","method","originMethod","bind","args","_overridden","autoFixContext","err","console","warn","ProviderBridge","ctxValues","length","ctxValue","onUpdate","unmount","restValues","nextChildren","ConsumerWrapper","id","get","fn","ctxInfo","updator","set","prevValue","shouldUpdate","renderWrapper","renderContent","ctx$$","fixedContextSnapshot","RecursiveConsumerBridge","renderChildren","reduce","render","isSupported","lazy","SusNotSupported","Lazy","FallbackListener","SuspenseBridge","sus$$","onSuspenseStart","onSuspenseEnd","LazyBridge","suspense","ErrorBoundaryBridge","error","throwError","error$$","ErrorThrower","cb","Bridge","bridgeProps","Acceptor","ConsumerBridge","LIFECYCLE_ACTIVATE","LIFECYCLE_UNACTIVATE","withActivation","WrappedComponent","HOC","drop","forwardedRef","attach","ref","every","lifecycleName","current","prototype","componentDidMount","_componentDidMount","call","forwardRef","ForwardedRefHOC","hoistStatics","useActivation","funcName","func","useRef","some","useActivate","useUnactivate","ReactFreeze","Keeper","rest","nextState","callback","unmounted","listeners","isKeepAlive","store","cache","aliveNodesId","Set","delay","timeout","scope","clearTimeout","willDrop","nodes","helpers","smartForceUpdate","canDrop","canRefresh","safeSetState","key","Math","random","node","wrapper","has","e","inited","cached","keepers","appendChild","freezeTimeout","listener","reverse","contextValue","Children","map","child","idx","cloneElement","HANDLE_TYPE_DROP","HANDLE_TYPE_REFRESH","AliveScope","forceUpdate","updateCallbackList","debouncedForceUpdate","params","keeper","isNew","now","Date","createTime","updateTime","update","then","name","getCachingNodes","filter","test","ids","getCachingNodesId","getCache","size","handleNodes","getScopeIds","getCachingNodesByName","dropScopeByIds","refreshScopeByIds","nodesId","handleKeepers","all","responses","Boolean","values","keep","dropScope","dropById","refresh","refreshScope","refreshById","clear","getNode","display","renderDefaultScope","container","ReactDOM","createRoot","controllerCherryPick","controller","expandKeepAlive","KeepAlive","idPrefix","isOutsideAliveScope","_nk","HookExpand","WithExpand","withAliveScope","HookScope","WithScope","HOCWithAliveScope","useAliveController","isScrollableNode","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","saveScrollPosition","saver","x","scrollLeft","y","scrollTop","revert","body","screenScrollingElement","getErrorTips","parseWhenResult","res","updateTimes","needForceStopUpdate","errorTips","releaseUpdateTimes","didActivate","_helpers","revertScrollPos","willUnactivate","nodesNeedToSaveScrollPosition","flag","removeChild","getInstance","inject","init","when","calcWhen","isScope","eject","needToDrop","SSRKeepAlive"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACO,IAAMA,QAAQ,GAAG,SAAXA,QAAW,CAACC,GAAD;AAAA,SAASA,GAAG,YAAYC,MAAxB;AAAA,CAAjB;;ACEA,IAAMC,iBAAiB,GAAGC,eAAa,EAAvC;AACA,IACKC,kBADL,GAGHF,iBAHG,CACLG,QADK;AAAA,IAEKC,kBAFL,GAGHJ,iBAHG,CAELK,QAFK;AAMA,IAAMC,gBAAgB,GAAGL,eAAa,EAAtC;AACA,IACKM,iBADL,GAGHD,gBAHG,CACLH,QADK;AAAA,IAEKK,iBAFL,GAGHF,gBAHG,CAELD,QAFK;;ACRA,IAAMI,QAAQ,GAAG,eAAjB;AAEP,IAAaC,iBAAb;AAAA;;AAAA;;AAIE,6BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;AACAD,IAAAA,iBAAiB,CAACE,mBAAlB,GAAwCD,KAAK,CAACE,KAA9C;AAFiB;AAGlB;;AAPH;AAAA;AAAA,WASE,+BAAsBC,SAAtB,EAAiC;AAC/B,UAAIA,SAAS,CAACD,KAAV,KAAoB,KAAKF,KAAL,CAAWE,KAAnC,EAA0C;AACxCH,QAAAA,iBAAiB,CAACE,mBAAlB,GAAwCE,SAAS,CAACD,KAAlD;AACAJ,QAAAA,QAAQ,CAACM,IAAT,CAAc,QAAd,EAAwBD,SAAS,CAACD,KAAlC;AACD;;AAED,aACEC,SAAS,CAACE,QAAV,KAAuB,KAAKL,KAAL,CAAWK,QAAlC,IACAF,SAAS,CAACD,KAAV,KAAoB,KAAKF,KAAL,CAAWE,KAFjC;AAID;AAnBH;AAAA;AAAA,WAqBE,kBAAS;AACP,UAAQG,QAAR,GAAqB,KAAKL,KAA1B,CAAQK,QAAR;AACA,aAAOA,QAAP;AACD;AAxBH;;AAAA;AAAA,EAAuCC,eAAvC;;gBAAaP,+BACOD;;gBADPC,0CAEkBQ;;AAyB/B,IAAaC,iBAAb;AAAA;;AAAA;;AAKE,6BAAYR,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,gCAAMA,KAAN;;AADiB,6DAJX;AACNS,MAAAA,OAAO,EAAEV,iBAAiB,CAACE;AADrB,KAIW;;AAAA,sEAKF,UAAS,UAACS,gBAAD,EAAsB;AAC9C,aAAKC,QAAL,CAAc;AACZF,QAAAA,OAAO,EAAEC;AADG,OAAd;AAGD,KAJgB,CALE;;AAEjBZ,IAAAA,QAAQ,CAACc,EAAT,CAAY,QAAZ,EAAsB,OAAKC,cAA3B;AAFiB;AAGlB;;AARH;AAAA;AAAA,WAgBE,gCAAuB;AACrBf,MAAAA,QAAQ,CAACgB,GAAT,CAAa,QAAb,EAAuB,KAAKD,cAA5B;AACD;AAlBH;AAAA;AAAA,WAoBE,kBAAS;AACP,UAAQR,QAAR,GAAqB,KAAKL,KAA1B,CAAQK,QAAR;AACA,UAAQI,OAAR,GAAoB,KAAKM,KAAzB,CAAQN,OAAR;AACA,aAAO,KAAIJ,QAAJ,EAAcE,SAAd,EAAyBE,OAAzB,CAAP;AACD;AAxBH;;AAAA;AAAA,EAAuCO,mBAAvC;;;;ACdA,AAAO,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AACnC,MAAI,CAAC,YAAWC,gBAAX,CAAL,EAA6B;AAC3B,WAAO,EAAP;AACD;;AAED,MAAMC,iBAAiB,GAAGD,gBAAU,CAAC7B,iBAAD,CAApC;;AAEA,MAAI8B,iBAAJ,EAAuB;AACrB,WAAOA,iBAAP;AACD;;AAED,kBAA8BC,cAAQ,CAACrB,iBAAiB,CAACE,mBAAnB,CAAtC;AAAA;AAAA,MAAOQ,OAAP;AAAA,MAAgBY,UAAhB;;AAEAC,EAAAA,eAAS,CAAC,YAAM;AACd,QAAMT,cAAc,GAAG,UAASQ,UAAT,CAAvB;;AACAE,IAAAA,QAAmB,CAACX,EAApB,CAAuB,QAAvB,EAAiCC,cAAjC;AACA,WAAO;AAAA,aAAMU,QAAmB,CAACT,GAApB,CAAwB,QAAxB,EAAkCD,cAAlC,CAAN;AAAA,KAAP;AACD,GAJQ,EAIN,EAJM,CAAT;AAMA,SAAOJ,OAAP;AACD,CApBM;AAsBP,AAAO,IAAMlB,oBAAkB,GAAG,SAArBA,oBAAqB;AAAA,MAAGc,QAAH,QAAGA,QAAH;AAAA,MAAgBL,KAAhB;;AAAA,sBAChCwB,6BAACC,kBAAD,eAA6BzB,KAA7B;AAAA;AAAA,mBACEwB,6BAAC,iBAAD,eAAuBxB,KAAvB;AAAA;AAAA,MAA+BK,QAA/B,CADF,CADgC;AAAA,CAA3B;AAKP,AAAO,IAAMZ,oBAAkB,GAAG,SAArBA,oBAAqB;AAAA,MAAGY,QAAH,SAAGA,QAAH;AAAA,sBAChCmB,6BAACE,kBAAD;AAAA;AAAA,KACG,UAACC,YAAD;AAAA,WACC,CAAC,CAACA,YAAF,GACE,KAAItB,QAAJ,EAAcE,SAAd,EAAyBoB,YAAzB,CADF,gBAGEH,6BAAC,iBAAD;AAAA;AAAA,OAAoBnB,QAApB,CAJH;AAAA,GADH,CADgC;AAAA,CAA3B;;ACxCP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;IAEMuB;;;;;;;;;;;;;;;;mEACW;;;;;;;WACf,kBAAS;AACP,wBAA6B,KAAK5B,KAAlC;AAAA,UAAQ6B,MAAR,eAAQA,MAAR;AAAA,UAAgBxB,QAAhB,eAAgBA,QAAhB;AACA,UAAQyB,YAAR,GAAyB,IAAzB,CAAQA,YAAR;;AAEA,UAAID,MAAM,IAAI,CAACC,YAAY,CAACC,OAA5B,EAAqC;AACnCD,QAAAA,YAAY,CAACC,OAAb,GAAuB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9CH,UAAAA,YAAY,CAACG,OAAb,GAAuBA,OAAvB;AACD,SAFsB,CAAvB;AAGA,cAAMH,YAAY,CAACC,OAAnB;AACD,OALD,MAKO,IAAIF,MAAJ,EAAY;AACjB,cAAMC,YAAY,CAACC,OAAnB;AACD,OAFM,MAEA,IAAID,YAAY,CAACC,OAAjB,EAA0B;AAC/BD,QAAAA,YAAY,CAACG,OAAb;AACAH,QAAAA,YAAY,CAACC,OAAb,GAAuBxB,SAAvB;AACD;;AAED,0BAAOiB,6BAACU,cAAD,QAAW7B,QAAX,CAAP;AACD;;;;EAnBqBC;;AAsBxB,AAAe,SAAS6B,MAAT,OAA0D;AAAA,MAAxCN,MAAwC,QAAxCA,MAAwC;AAAA,MAAhCxB,QAAgC,QAAhCA,QAAgC;AAAA,8BAAtB+B,WAAsB;AAAA,MAAtBA,WAAsB,iCAAR,IAAQ;AACvE,sBACEZ,6BAACa,cAAD;AAAU,IAAA,QAAQ,EAAED,WAApB;AAAA;AAAA,kBACEZ,6BAAC,SAAD;AAAW,IAAA,MAAM,EAAEK,MAAnB;AAAA;AAAA,KAA4BxB,QAA5B,CADF,CADF;AAKD;;AC3CM,IAAMiC,YAAY,GAAG,EAArB;AACP,AAAO,IAAMC,mBAAmB,GAAG,IAAIC,GAAJ,EAA5B;AACP,AAAO,IAAM1C,UAAQ,GAAG,eAAjB;AAEP,IAAa2C,UAAU,GAAG,SAAQ,UAACC,GAAD,EAAS;AACzC,MAAI,CAAC,SAAQA,GAAR,CAAL,EAAmB;AACjB;AACD,GAHwC;;;AAMzC,MAAI,CAACrD,iBAAD,EAAoBM,gBAApB,EAAsCgD,QAAtC,CAA+CD,GAA/C,CAAJ,EAAyD;AACvD;AACD;;AACDJ,EAAAA,YAAY,CAACM,IAAb,CAAkBF,GAAlB;AACAG,EAAAA,UAAU,CAAC;AAAA,WAAM/C,UAAQ,CAACM,IAAT,CAAc,QAAd,CAAN;AAAA,GAAD,CAAV;AACD,CAXyB,CAAnB;AAaP,IAAad,aAAa,GAAG,SAAhBA,aAAgB,CAACwD,YAAD,EAAeC,oBAAf,EAAwC;AACnE,MAAML,GAAG,GAAGM,eAAkB,CAACF,YAAD,EAAeC,oBAAf,CAA9B;AAEAN,EAAAA,UAAU,CAACC,GAAD,CAAV;AACA,SAAOA,GAAP;AACD,CALM;;AAOP,IAAMO,SAAS,GAAG,SAAQ,UAACC,IAAD,EAAU;AAClC;AACA,MAAMR,GAAG,GAAG,KAAIQ,IAAJ,EAAU,UAAV,KAAyB,KAAIA,IAAJ,EAAU,SAAV,CAArC,CAFkC;AAIlC;;;AACA,MAAI,KAAIR,GAAJ,EAAS,UAAT,MAAyB,KAAIrD,iBAAJ,EAAuB,UAAvB,CAA7B,EAAiE;AAC/DoD,IAAAA,UAAU,CAACC,GAAD,CAAV;AACD;AACF,CARiB,CAAlB;;AAUA,IAAMS,QAAQ,GAAG,SAAXA,QAAW,CAACC,OAAD,EAAa;AAC5BA,EAAAA,OAAO,CAACC,OAAR,CAAgB,gBAAwB;AAAA;AAAA,QAAtBC,IAAsB;AAAA,QAAbC,OAAa;;AACtCA,IAAAA,OAAO,CAACF,OAAR,CAAgB,UAACG,MAAD,EAAY;AAC1B,UACE,CAAC,YAAW,KAAIF,IAAJ,EAAUE,MAAV,CAAX,CAAD,IACA,KAAIF,IAAJ,EAAU,CAACE,MAAD,EAAS,aAAT,CAAV,CAFF,EAGE;AACA;AACD;;AACD,UAAMC,YAAY,GAAGH,IAAI,CAACE,MAAD,CAAJ,CAAaE,IAAb,CAAkBJ,IAAlB,CAArB;;AACAA,MAAAA,IAAI,CAACE,MAAD,CAAJ,GAAe,UAACN,IAAD,EAAmB;AAChC,YAAI,CAAC,UAASA,IAAT,CAAL,EAAqB;AACnBD,UAAAA,SAAS,CAACC,IAAD,CAAT;AACD;;AAH+B,0CAATS,IAAS;AAATA,UAAAA,IAAS;AAAA;;AAIhC,eAAOF,YAAY,MAAZ,UAAaP,IAAb,SAAsBS,IAAtB,EAAP;AACD,OALD;;AAMAL,MAAAA,IAAI,CAACE,MAAD,CAAJ,CAAaI,WAAb,GAA2B,IAA3B;AACD,KAfD;AAgBD,GAjBD;AAkBD,CAnBD;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAaC,cAAc,GAAG,SAAjBA,cAAiB,GAAgB;AAC5C,MAAI;AAAA,uCAD4BT,OAC5B;AAD4BA,MAAAA,OAC5B;AAAA;;AACFD,IAAAA,QAAQ,CAACC,OAAD,CAAR;AACD,GAFD,CAEE,OAAOU,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,IAAR,CAAa,6BAAb,EAA4CF,GAA5C;AACD;AACF,CANM;AAQPD,cAAc,CAAC,CAACrC,cAAD,EAAQ,eAAR,CAAD,CAAd;;;;IChFqByC;;;;;AAEnB,0BAAYjE,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,8DADT,IACS;;AAGjB,QAAekE,SAAf,GAA6BlE,KAA7B,CAAQE,KAAR;;AAEA,QAAIgE,SAAS,CAACC,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,YAAKpD,KAAL,GAAa;AACXqD,QAAAA,QAAQ,EAAE;AADC,OAAb;AAIA;AACD;;AAED,oCAAmCF,SAAnC;AAAA;AAAA,QAASxB,GAAT,eAASA,GAAT;AAAA,QAAcxC,KAAd,eAAcA,KAAd;AAAA,QAAqBmE,QAArB,eAAqBA,QAArB;;AAEA,UAAKtD,KAAL,GAAa;AACXqD,MAAAA,QAAQ,EAAElE;AADC,KAAb;AAIA,UAAKoE,OAAL,GAAeD,QAAQ,CAAC,UAACnE,KAAD,EAAW;AACjC,YAAKS,QAAL,CAAc;AACZyD,QAAAA,QAAQ,EAAElE;AADE,OAAd;AAGD,KAJsB,CAAvB;AAnBiB;AAwBlB;;;;WAED,gCAAuB;AACrB,WAAI,KAAKoE,OAAT;AACD;AAGD;AACA;;;;WAEA,kBAAS;AACP,wBAAuC,KAAKtE,KAA5C;AAAA,UAAekE,SAAf,eAAQhE,KAAR;AAAA,UAA0BG,QAA1B,eAA0BA,QAA1B;;AAEA,UAAI6D,SAAS,CAACC,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,eAAO9D,QAAP;AACD;;AAED,UAAQ+D,QAAR,GAAqB,KAAKrD,KAA1B,CAAQqD,QAAR;;AACA,iCAAiCF,SAAjC;AAAA,UAASxB,GAAT,kBAASA,GAAT;AAAA,UAAmB6B,UAAnB;;AACA,UAAQ/E,QAAR,GAAqBkD,GAArB,CAAQlD,QAAR;AAEA,UAAMgF,YAAY,GAAG,CAAC,aAAYJ,QAAZ,CAAD,gBACnB5C,6BAAC,QAAD;AAAU,QAAA,KAAK,EAAE4C,QAAjB;AAAA;AAAA,SAA4B/D,QAA5B,CADmB,GAGnBA,QAHF,CAXO;AAkBP;;AACA,aAAOkE,UAAU,CAACJ,MAAX,GAAoB,CAApB,gBACL3C,6BAAC,cAAD;AAAgB,QAAA,KAAK,EAAE+C,UAAvB;AAAA;AAAA,SAAoCC,YAApC,CADK,GAGLA,YAHF;AAKD;;;;EA5DyCxD;;ICIvByD;;;;;AAGnB,2BAAYzE,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,qEAFF,IAEE;;AAAA,8DADT,IACS;;AAGjB,QAAQE,KAAR,GAA2BF,KAA3B,CAAQE,KAAR;AAAA,QAAewC,GAAf,GAA2B1C,KAA3B,CAAe0C,GAAf;AAAA,QAAoBgC,EAApB,GAA2B1E,KAA3B,CAAoB0E,EAApB;;AACA,QAAI,aAAYxE,KAAZ,CAAJ,EAAwB;AACtB;AACD,KANgB;AASjB;AACA;;;AACA,UAAKW,cAAL,GAAsB,KAAI0B,mBAAmB,CAACoC,GAApB,CAAwBjC,GAAxB,CAAJ,EAAkCgC,EAAlC,EAAsC,IAAIlC,GAAJ,EAAtC,CAAtB;;AACA,SAAI,MAAK3B,cAAT,EAAyB,SAAzB,EAAoC,UAAC+D,EAAD;AAAA,aAAQA,EAAE,CAAC1E,KAAD,CAAV;AAAA,KAApC;;AACA,UAAK2E,OAAL,GAAe;AACbnC,MAAAA,GAAG,EAAHA,GADa;AAEbxC,MAAAA,KAAK,EAALA,KAFa;AAGb;AACAmE,MAAAA,QAAQ,EAAE,kBAACS,OAAD,EAAa;AACrB,cAAKjE,cAAL,CAAoBkE,GAApB,CAAwBD,OAAxB,EAAiCA,OAAjC,EADqB;;;AAIrB,eAAO;AAAA,iBAAM,MAAKjE,cAAL,WAA2BiE,OAA3B,CAAN;AAAA,SAAP;AACD;AATY,KAAf;AAbiB;AAwBlB;;;;WAED,gCAAuB;AACrB,wBAA2B,KAAK9E,KAAhC;AAAA,UAAQE,KAAR,eAAQA,KAAR;AAAA,UAAewC,GAAf,eAAeA,GAAf;AAAA,UAAoBgC,EAApB,eAAoBA,EAApB;;AACA,UAAI,aAAYxE,KAAZ,CAAJ,EAAwB;AACtB;AACD,OAJoB;AAOrB;;;AACAqC,MAAAA,mBAAmB,CAACwC,GAApB,CAAwBrC,GAAxB,oCACK,KAAIH,mBAAmB,CAACoC,GAApB,CAAwBjC,GAAxB,CAAJ,EAAkCnC,SAAlC,EAA6C,EAA7C,CADL,2BAEGmE,EAFH,EAEQ,KAAK7D,cAFb;AAID;AAGD;;;;WACA,qCAAiC;AAAA,UAATX,KAAS,QAATA,KAAS;AAC/B,UAAe8E,SAAf,GAA6B,KAAKhF,KAAlC,CAAQE,KAAR;AACA,UAAM+E,YAAY,GAAGD,SAAS,KAAK9E,KAAnC;;AAEA,UAAI+E,YAAJ,EAAkB;AAChB,aAAI,KAAKpE,cAAT,EAAyB,SAAzB,EAAoC,UAAC+D,EAAD;AAAA,iBAAQA,EAAE,CAAC1E,KAAD,CAAV;AAAA,SAApC;AACD;;AAED,aAAO+E,YAAP;AACD;;;WAED,kBAAS;AAAA;;AACP,yBAAoD,KAAKjF,KAAzD;AAAA,UAAQE,KAAR,gBAAQA,KAAR;AAAA,UAAegF,aAAf,gBAAeA,aAAf;AAAA,UAA8BC,aAA9B,gBAA8BA,aAA9B;AAAA,UAA6CT,EAA7C,gBAA6CA,EAA7C;AAEA,aAAOQ,aAAa,CAAC,UAACE,KAAD;AAAA,eACnBD,aAAa,CAAC,aAAYjF,KAAZ,IAAqBkF,KAArB,gCAAiCA,KAAjC,IAAwC,MAAI,CAACP,OAA7C,EAAD,CADM;AAAA,OAAD,CAApB;AAGD;;;;EA9D0CvE;;;ACM7C,IAAM+E,oBAAoB,GAAG,EAA7B;;IAGMC;;;;;AACJ,mCAAYtF,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,oEASH,UAACuF,cAAD,EAAoB;AAClC,UAAQb,EAAR,GAAe,MAAK1E,KAApB,CAAQ0E,EAAR;AAEA,UAAMQ,aAAa,GAAGG,oBAAoB,CAACX,EAAD,CAApB,CAAyBc,MAAzB,CACpB,UAACC,MAAD,EAAS/C,GAAT,EAAiB;AACf,YAAQhD,QAAR,GAAqBgD,GAArB,CAAQhD,QAAR;;AAEA,YAAMwF,aAAa,GAAG,SAAhBA,aAAgB,CAACC,aAAD;AAAA,8BACpB3D,6BAAC,QAAD;AAAA;AAAA,aACG,UAACtB,KAAD;AAAA,gCACCsB,6BAAC,eAAD;AAEItB,cAAAA,KAAK,EAALA,KAFJ;AAGIwC,cAAAA,GAAG,EAAHA,GAHJ;AAIIwC,cAAAA,aAAa,EAAEO,MAJnB;AAKIN,cAAAA,aAAa,EAAbA,aALJ;AAMIT,cAAAA,EAAE,EAAFA,EANJ;AAAA;AAAA,cADD;AAAA,WADH,CADoB;AAAA,SAAtB;;AAgBA,eAAOQ,aAAP;AACD,OArBmB,EAsBpB,UAACC,aAAD;AAAA,eAAmBA,aAAa,CAAC,EAAD,CAAhC;AAAA,OAtBoB,CAAtB;AAyBA,aAAOD,aAAa,CAACK,cAAD,CAApB;AACD,KAtCkB;;AAEjB,QAAQb,GAAR,GAAe1E,KAAf,CAAQ0E,EAAR;;AAEA,QAAI,CAACW,oBAAoB,CAACX,GAAD,CAAzB,EAA+B;AAC7BW,MAAAA,oBAAoB,CAACX,GAAD,CAApB,sBAA+BpC,YAA/B;AACD;;AANgB;AAOlB;;;;WAiCD,kBAAS;AACP,UAAkBiD,cAAlB,GAAqC,KAAKvF,KAA1C,CAAQK,QAAR;AAEA,aAAO,KAAK6E,aAAL,CAAmBK,cAAnB,CAAP;AACD;;;;EA7CmCvE;;;ACbtC;AACA,IAAM0E,WAAW,GAAG,YAAWC,UAAX,KAAoB,CAAC,aAAYtD,cAAZ,CAAzC;;AACA,IAAMuD,eAAe,GAAG,SAAlBA,eAAkB;AAAA,MAAGvF,QAAH,QAAGA,QAAH;AAAA,SAAkB,KAAIA,QAAJ,CAAlB;AAAA,CAAxB;;AAEA,IAAMwF,IAAI,GAAGH,WAAW,gBAAGC,UAAI,CAAC;AAAA,SAAM,IAAI3D,OAAJ,CAAY;AAAA,WAAM,IAAN;AAAA,GAAZ,CAAN;AAAA,CAAD,CAAP,GAAyC;AAAA,SAAM,IAAN;AAAA,CAAjE;;IAEM8D;;;;;;;;;;;;;WACJ,6BAAoB;AAClB,WAAI,KAAK9F,KAAT,EAAgB,SAAhB;AACD;;;WAED,gCAAuB;AACrB,WAAI,KAAKA,KAAT,EAAgB,OAAhB;AACD;;;WAED,kBAAS;AACP,aAAO,IAAP;AACD;;;;EAX4BM;;AAc/B,SAASyF,cAAT,QAA6C;AAAA,MAAnB1F,QAAmB,SAAnBA,QAAmB;AAAA,MAAT2F,KAAS,SAATA,KAAS;AAC3C;AAAA;AACE;AACA,iCAAC3D,cAAD;AACE,MAAA,QAAQ,eACNb,6BAAC,gBAAD;AACE,QAAA,OAAO,EAAEwE,KAAK,CAACC,eADjB;AAEE,QAAA,KAAK,EAAED,KAAK,CAACE,aAFf;AAAA;AAAA,QAFJ;AAAA;AAAA,OAQG7F,QARH;AAFF;AAaD;;AAED,AAAO,IAAM8F,UAAU,GAAGT,WAAW;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA,4DAEvB;AACNU,MAAAA,QAAQ,EAAE;AADJ,KAFuB;;AAAA,sEAMb,YAAM;AACtB,YAAKzF,QAAL,CAAc;AACZyF,QAAAA,QAAQ,EAAE;AADE,OAAd;AAGD,KAV8B;;AAAA,oEAYf,YAAM;AACpB,YAAKzF,QAAL,CAAc;AACZyF,QAAAA,QAAQ,EAAE;AADE,OAAd;AAGD,KAhB8B;;AAAA,4DAkBvB;AACNH,MAAAA,eAAe,EAAE,MAAKA,eADhB;AAENC,MAAAA,aAAa,EAAE,MAAKA;AAFd,KAlBuB;;AAAA;AAAA;;AAAA;AAAA;AAAA,WAuB/B,kBAAS;AACP,UAAQ7F,QAAR,GAAqB,KAAKL,KAA1B,CAAQK,QAAR;AAEA,0BACEmB,6BAACU,cAAD,QACG,KAAI7B,QAAJ,EAAcE,SAAd,EAAyB,KAAKyF,KAA9B,CADH,EAGG,KAAKjF,KAAL,CAAWqF,QAAX,iBAAuB5E,6BAAC,IAAD;AAAA;AAAA,QAH1B,CADF;AAOD;AAjC8B;;AAAA;AAAA,EACRlB,eADQ,IAmCjCsF,eAnCG;AAqCP,uBAAeF,WAAW,GAAGK,cAAH,GAAoBH,eAA9C;;ICzEqBS;;;;;;;;;;;;;;AAGnB,+BAAkBC,KAAlB,EAAyB;AACvB,UAAiBC,UAAjB,GAAgC,KAAKvG,KAArC,CAAQwG,OAAR;;AAEA,WAAID,UAAJ,EAAgBhG,SAAhB,EAA2B+F,KAA3B,EAAkC,YAAM;AACtC,aAAIC,UAAJ,EAAgBhG,SAAhB,EAA2B,IAA3B;AACD,OAFD;AAGD;;;WAED,kBAAS;AACP,aAAO,KAAKP,KAAL,CAAWK,QAAlB;AACD;;;;EAb8CC;;gBAA5B+F,iDAEe;AAAA,SAAM,IAAN;AAAA;IAcvBI,YAAb;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA,4DACU;AACNH,MAAAA,KAAK,EAAE;AADD,KADV;;AAAA,iEAKe,UAACA,KAAD,EAAQI,EAAR;AAAA,aAAe,MAAK/F,QAAL,CAAc;AAAE2F,QAAAA,KAAK,EAALA;AAAF,OAAd,EAAyBI,EAAzB,CAAf;AAAA,KALf;;AAAA;AAAA;;AAAA;AAAA;AAAA,WAME,kBAAS;AACP,UAAI,KAAK3F,KAAL,CAAWuF,KAAf,EAAsB;AACpB,cAAM,KAAKvF,KAAL,CAAWuF,KAAjB;AACD;;AAED,aAAO,KAAI,KAAKtG,KAAL,CAAWK,QAAf,EAAyBE,SAAzB,EAAoC,KAAKgG,UAAzC,CAAP;AACD;AAZH;;AAAA;AAAA,EAAkCjG,eAAlC;;;ACXA,AAAe,SAASqG,MAAT,OAA+C;AAAA,MAA7BjC,EAA6B,QAA7BA,EAA6B;AAAA,MAAzBrE,QAAyB,QAAzBA,QAAyB;AAAA,MAAfuG,WAAe,QAAfA,WAAe;AAC5D,MAAQZ,KAAR,GAAkCY,WAAlC,CAAQZ,KAAR;AAAA,MAAeZ,KAAf,GAAkCwB,WAAlC,CAAexB,KAAf;AAAA,MAAsBoB,OAAtB,GAAkCI,WAAlC,CAAsBJ,OAAtB;AAEA;AAAA;;AACE;AACA,iCAAC,mBAAD;AAAqB,MAAA,OAAO,EAAEA,OAA9B;AAAA;AAAA,oBAEEhF,6BAACuE,gBAAD;AAAgB,MAAA,KAAK,EAAEC,KAAvB;AAAA;AAAA,oBAEExE,6BAAC,cAAD;AAAgB,MAAA,EAAE,EAAEkD,EAApB;AAAwB,MAAA,KAAK,EAAEU,KAA/B;AAAA;AAAA,OACG/E,QADH,CAFF,CAFF;AAFF;AAYD;;AAGD,AAAO,SAASwG,QAAT,QAAoC;AAAA,MAAhBnC,EAAgB,SAAhBA,EAAgB;AAAA,MAAZrE,QAAY,SAAZA,QAAY;AACzC;AAAA;;AACE;AACA,iCAAC,YAAD;AAAA;AAAA,OACG,UAACmG,OAAD;AAAA;AAAA;;AACC;AACA,qCAAC,UAAD;AAAA;AAAA,WACG,UAACR,KAAD;AAAA;AAAA;;AACC;AACA,yCAACc,uBAAD;AAAgB,cAAA,EAAE,EAAEpC,EAApB;AAAA;AAAA,eACG,UAACU,KAAD;AAAA,qBACC,KAAI/E,QAAJ,EAAcE,SAAd,EAAyB;AACvBqG,gBAAAA,WAAW,EAAE;AACXZ,kBAAAA,KAAK,EAALA,KADW;AAEXZ,kBAAAA,KAAK,EAALA,KAFW;AAGXoB,kBAAAA,OAAO,EAAPA;AAHW;AADU,eAAzB,CADD;AAAA,aADH;AAFD;AAAA,SADH;AAFD;AAAA,KADH;AAFF;AAwBD;;;;AC/BD,AAAO,IAAMO,kBAAkB,GAAG,sBAA3B;AACP,AAAO,IAAMC,oBAAoB,GAAG,yBAA7B;AAEP,IAAaC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,gBAAD,EAAsB;AAAA,MAC5CC,GAD4C;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA,6DAEzC,IAFyC;;AAAA;AAAA;;AAAA;AAAA;AAAA,aAIhD,gCAAuB;AACrB,aAAI,KAAKC,IAAT;AACD;AAN+C;AAAA;AAAA,aAQhD,kBAAS;AAAA;;AACP,0BAAmC,KAAKpH,KAAxC;AAAA,YAAQqH,YAAR,eAAQA,YAAR;AAAA,YAAyBrH,KAAzB;;AAEA,4BACEwB,6BAAC,iBAAD;AAAA;AAAA,WACG;AAAA,yFAAc,EAAd;AAAA,cAAG8F,MAAH,QAAGA,MAAH;;AAAA,8BACC9F,6BAAC,gBAAD;AACE,YAAA,GAAG,EAAE,aAAC+F,KAAD,EAAS;AACZ,kBACE,CAACR,kBAAD,EAAqBC,oBAArB,EAA2CQ,KAA3C,CACE,UAACC,aAAD;AAAA,uBAAmB,CAAC,YAAW,KAAIF,KAAJ,EAASE,aAAT,CAAX,CAApB;AAAA,eADF,CADF,EAIE;AACA;AACD;;AACD,cAAA,MAAI,CAACL,IAAL,GAAY,KAAIE,MAAJ,EAAY/G,SAAZ,EAAuBgH,KAAvB,CAAZ,CARY;;AAWZ,kBAAI,aAAYF,YAAZ,CAAJ,EAA+B;AAC7B;AACD;;AAED,kBAAI,UAASA,YAAT,KAA0B,aAAaA,YAA3C,EAAyD;AACvDA,gBAAAA,YAAY,CAACK,OAAb,GAAuBH,KAAvB;AACA;AACD;;AAED,mBAAIF,YAAJ,EAAkB9G,SAAlB,EAA6BgH,KAA7B;AACD;AAtBH,aAuBMvH,KAvBN;AAAA;AAAA,aADD;AAAA,SADH,CADF;AA+BD;AA1C+C;;AAAA;AAAA,IAChCM,eADgC;AA8ClD;AACA;AACA;;;AAEA,MAAI,YAAW4G,gBAAgB,CAACS,SAAjB,CAA2BC,iBAAtC,CAAJ,EAA8D;AAC5DV,IAAAA,gBAAgB,CAACS,SAAjB,CAA2BE,kBAA3B,GACEX,gBAAgB,CAACS,SAAjB,CAA2BC,iBAD7B;;AAEAV,IAAAA,gBAAgB,CAACS,SAAjB,CAA2BC,iBAA3B,GAA+C,SAASA,iBAAT,GAA6B;AAAA;;AAC1E,gBAAS;AAAA,eAAMV,gBAAgB,CAACS,SAAjB,CAA2BE,kBAA3B,CAA8CC,IAA9C,CAAmD,MAAnD,CAAN;AAAA,OAAT;AACD,KAFD;AAGD;;AAED,MAAI,YAAWC,gBAAX,CAAJ,EAA4B;AAC1B,QAAMC,eAAe,gBAAGD,gBAAU,CAAC,UAAC/H,KAAD,EAAQuH,GAAR;AAAA,0BACjC/F,6BAAC,GAAD,eAASxB,KAAT;AAAgB,QAAA,YAAY,EAAEuH,GAA9B;AAAA;AAAA,SADiC;AAAA,KAAD,CAAlC;AAIA,WAAOU,YAAY,CAACD,eAAD,EAAkBd,gBAAlB,CAAnB;AACD,GAND,MAMO;AACL,WAAOe,YAAY,CAACd,GAAD,EAAMD,gBAAN,CAAnB;AACD;AACF,CAnEM;;AAqEP,IAAMgB,aAAa,GAAG,SAAhBA,aAAgB,CAACC,QAAD,EAAWC,IAAX,EAAoB;AACxC;AACA,MAAI,CAACC,YAAD,EAASnH,gBAAT,EAAqBI,eAArB,EAAgCgH,IAAhC,CAAqC,UAAC1D,EAAD;AAAA,WAAQ,CAAC,YAAWA,EAAX,CAAT;AAAA,GAArC,CAAJ,EAAmE;AACjE;AACD;;AAED,MAAMR,QAAQ,GAAGlD,gBAAU,CAACvB,gBAAD,CAA3B,CANwC;;AASxC,MAAI,CAACyE,QAAL,EAAe;AACb;AACD;;AAED,gBAAyBiE,YAAM,CAAC,EAAD,CAA/B;AAAA,MAAiBd,GAAjB,WAAQG,OAAR;;AACA,MAAQJ,MAAR,GAAmBlD,QAAnB,CAAQkD,MAAR;AAEAC,EAAAA,GAAG,CAACY,QAAD,CAAH,GAAgBC,IAAhB;AACAb,EAAAA,GAAG,CAACH,IAAJ,GAAWE,MAAM,CAACC,GAAD,CAAjB;AAEAjG,EAAAA,eAAS,CAAC,YAAM;AACd,WAAO;AAAA,aAAM,KAAIiG,GAAG,CAACH,IAAR,CAAN;AAAA,KAAP;AACD,GAFQ,EAEN,EAFM,CAAT;AAGD,CAtBD;;AAwBA,IAAamB,WAAW,GAAGL,aAAa,CAACxE,IAAd,CAAmB,IAAnB,EAAyBqD,kBAAzB,CAApB;AACP,IAAayB,aAAa,GAAGN,aAAa,CAACxE,IAAd,CAAmB,IAAnB,EAAyBsD,oBAAzB,CAAtB;;;ACrHP;AAQA,IAAM7E,QAAM,GAAG,CAAC,CAACE,cAAF,GAAaoG,MAAb,GAA2B;AAAA,MAAGpI,QAAH,QAAGA,QAAH;AAAA,SAAkBA,QAAlB;AAAA,CAA1C;;IAEqBqI;;;;;AAKnB,kBAAY1I,KAAZ,EAA4B;AAAA;;AAAA;;AAAA,sCAAN2I,IAAM;AAANA,MAAAA,IAAM;AAAA;;AAC1B,6CAAM3I,KAAN,SAAgB2I,IAAhB;;AAD0B,+DAJjB,eAIiB;;AAAA,gEAHhB,IAAInG,GAAJ,EAGgB;;AAAA,8DAFlB,IAEkB;;AAAA,4DAWpBjC,SAXoB;;AAAA,gEA4ChB,KA5CgB;;AAAA,mEA6Cb,UAACqI,SAAD,EAAYC,QAAZ,EAAyB;AACtC;AACA,UAAI,MAAKC,SAAT,EAAoB;AAClB;AACD;;AACD,YAAKnI,QAAL,CAAciI,SAAd,EAAyBC,QAAzB;AACD,KAnD2B;;AAAA,oEAoEZ,IApEY;;AAAA,6DAgHnB,UAACtB,GAAD,EAAS;AAAA;;AAChB,UAAMwB,SAAS,GAAG,MAAKA,SAAvB;;AAEA,UAAI,CAACxB,GAAL,EAAU;AACR,eAAO;AAAA,iBAAM,IAAN;AAAA,SAAP;AACD;;AAED,UAAIA,GAAG,CAACyB,WAAR,EAAqB;AACnB,kBAAS,YAAM;AACb,4BAAsB,MAAKhJ,KAA3B;AAAA,cAAQ0E,EAAR,eAAQA,EAAR;AAAA,cAAYuE,KAAZ,eAAYA,KAAZ;AACA,cAAMC,KAAK,GAAGD,KAAK,CAACtE,GAAN,CAAUD,EAAV,CAAd;AACAwE,UAAAA,KAAK,CAACC,YAAN,GAAqB,IAAIC,GAAJ,8BAAYF,KAAK,CAACC,YAAlB,IAAgC5B,GAAG,CAAC7C,EAApC,GAArB;AACD,SAJD;AAKD;;AAEDqE,MAAAA,SAAS,CAAChE,GAAV,CAAcwC,GAAd,wDACGR,kBADH,EACwB;AAAA,eAAM,KAAIQ,GAAJ,EAASR,kBAAT,CAAN;AAAA,OADxB,mCAEGC,oBAFH,EAE0B;AAAA,eAAM,KAAIO,GAAJ,EAASP,oBAAT,CAAN;AAAA,OAF1B,oBAfgB;;AAqBhB,aAAO,YAAM;AACX+B,QAAAA,SAAS,UAAT,CAAiBxB,GAAjB;AACD,OAFD;AAGD,KAxI2B;;AAAA,mEA2Ib;AACb7C,MAAAA,EAAE,EAAE,MAAK1E,KAAL,CAAW0E,EADF;AAEb4C,MAAAA,MAAM,EAAE,MAAKA;AAFA,KA3Ia;;AAAA,2DAgJrB;AAAA,sFAAoB,EAApB;AAAA,8BAAG+B,KAAH;AAAA,UAAGA,KAAH,4BAAW,IAAX;;AAAA,aACL,IAAIrH,OAAJ,CAAY,UAACC,OAAD,EAAa;AACvB,YAAIqH,OAAJ;AACA,2BAAsB,MAAKtJ,KAA3B;AAAA,YAAQuJ,KAAR,gBAAQA,KAAR;AAAA,YAAe7E,EAAf,gBAAeA,EAAf;;AACA,YAAM0C,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjBoC,UAAAA,YAAY,CAACF,OAAD,CAAZ;;AACA,gBAAKxJ,QAAL,CAAcgB,GAAd,CAAkBkG,oBAAlB,EAAwCI,IAAxC,EAFiB;;;AAIjB,gBAAK8B,KAAL,CAAWO,QAAX,GAAsB,IAAtB;AACAF,UAAAA,KAAK,CAACG,KAAN,WAAmBhF,EAAnB;AACA6E,UAAAA,KAAK,CAACI,OAAN,sBAAqBJ,KAAK,CAACI,OAA3B;AACAJ,UAAAA,KAAK,CAACK,gBAAN,CAAuB;AAAA,mBAAM3H,OAAO,CAAC,IAAD,CAAb;AAAA,WAAvB;AACD,SARD;;AAUA,YAAM4H,OAAO,GAAG,KAAI,MAAKX,KAAT,EAAgB,QAAhB,KAA6B,KAAI,MAAKA,KAAT,EAAgB,UAAhB,CAA7C;;AACA,YAAI,CAACW,OAAL,EAAc;AACZ,gBAAK/J,QAAL,CAAcc,EAAd,CAAiBoG,oBAAjB,EAAuCI,IAAvC;;AACAkC,UAAAA,OAAO,GAAGzG,UAAU,CAAC,YAAM;AACzB,kBAAK/C,QAAL,CAAcgB,GAAd,CAAkBkG,oBAAlB,EAAwCI,IAAxC;;AACAnF,YAAAA,OAAO,CAAC,KAAD,CAAP;AACD,WAHmB,EAGjBoH,KAHiB,CAApB;AAIA;AACD;;AAEDjC,QAAAA,IAAI;AACL,OAxBD,CADK;AAAA,KAhJqB;;AAAA,8DA2KlB;AAAA,aACR,IAAIpF,OAAJ,CAAY,UAACC,OAAD,EAAa;AACvB,YAAM6H,UAAU,GAAG,CAAC,KAAI,MAAKZ,KAAT,EAAgB,QAAhB,CAApB;;AACA,YAAI,CAACY,UAAL,EAAiB;AACf7H,UAAAA,OAAO,CAAC,KAAD,CAAP;AACD;;AACD,cAAK8H,YAAL,CACE;AACEC,UAAAA,GAAG,EAAEC,IAAI,CAACC,MAAL;AADP,SADF,EAIE;AAAA,iBAAMjI,OAAO,CAAC,IAAD,CAAb;AAAA,SAJF;AAMD,OAXD,CADQ;AAAA,KA3KkB;;AAG1B,UAAKlB,KAAL,GAAa;AACXV,MAAAA,QAAQ,EAAEL,KAAK,CAACK,QADL;AAEXuG,MAAAA,WAAW,EAAE5G,KAAK,CAAC4G,WAFR;AAGXoD,MAAAA,GAAG,EAAEC,IAAI,CAACC,MAAL,EAHM;AAIXrI,MAAAA,MAAM,EAAE;AAJG,KAAb;AAH0B;AAS3B;;;;WAGD,6BAAoB;AAAA;AAAA;;AAClB,yBAAsB,KAAK7B,KAA3B;AAAA,UAAQiJ,KAAR,gBAAQA,KAAR;AAAA,UAAevE,EAAf,gBAAeA,EAAf;AACA,UAAMqE,SAAS,GAAG,KAAKA,SAAvB;AACA,UAAMoB,IAAI,GAAG,KAAKC,OAAlB,CAHkB;;AAMlB,UAAInB,KAAK,CAACoB,GAAN,CAAU3F,EAAV,CAAJ,EAAmB;AACjB;AACD;;AAED,UAAIgF,KAAJ;;AACA,UAAI;AACFA,QAAAA,KAAK,sBAAOS,IAAI,CAAC9J,QAAZ,CAAL;AACD,OAFD,CAEE,OAAOiK,CAAP,EAAU;AACVZ,QAAAA,KAAK,GAAG,CAACS,IAAI,CAAC9J,QAAN,CAAR;AACD;;AAED,WAAK6I,KAAL;AACEH,QAAAA,SAAS,EAATA,SADF;AAEEI,QAAAA,YAAY,EAAE,EAFhB;AAGEoB,QAAAA,MAAM,EAAE,KAHV;AAIEC,QAAAA,MAAM,EAAE,KAJV;AAKEJ,QAAAA,OAAO,EAAED,IALX;AAMET,QAAAA,KAAK,EAALA;AANF,sCAOG3C,kBAPH,EAOwB;AAAA,eAAM,MAAI,CAACA,kBAAD,CAAJ,EAAN;AAAA,OAPxB,gCAQGC,oBARH,EAQ0B;AAAA,eAAM,MAAI,CAACA,oBAAD,CAAJ,EAAN;AAAA,OAR1B;AAWAiC,MAAAA,KAAK,CAAClE,GAAN,CAAUL,EAAV,EAAc,KAAKwE,KAAnB;AACD;;;WAWD,gCAAuB;AACrB,yBAA+B,KAAKlJ,KAApC;AAAA,UAAQiJ,KAAR,gBAAQA,KAAR;AAAA,UAAewB,OAAf,gBAAeA,OAAf;AAAA,UAAwB/F,EAAxB,gBAAwBA,EAAxB,CADqB;;AAGrB,UAAI;AACF,YAAMwE,KAAK,GAAGD,KAAK,CAACtE,GAAN,CAAUD,EAAV,CAAd;AACAwE,QAAAA,KAAK,CAACQ,KAAN,CAAYrG,OAAZ,CAAoB,UAAC8G,IAAD,EAAU;AAC5BjB,UAAAA,KAAK,CAACkB,OAAN,CAAcM,WAAd,CAA0BP,IAA1B;AACD,SAFD;AAGD,OALD,CAKE,OAAO7D,KAAP,EAAc;AAEf;;AACD2C,MAAAA,KAAK,UAAL,CAAavE,EAAb;AACA+F,MAAAA,OAAO,UAAP,CAAe/F,EAAf;AACA,WAAKoE,SAAL,GAAiB,IAAjB;AACD;;SAIC/B;WAAD,iBAAuB;AACtByC,MAAAA,YAAY,CAAC,KAAKmB,aAAN,CAAZ,CADsB;;AAGtB,WAAKZ,YAAL,CAAkB;AAChBlI,QAAAA,MAAM,EAAE;AADQ,OAAlB;AAGA,WAAK/B,QAAL,CAAcM,IAAd,CAAmB2G,kBAAnB;AACA,WAAKgC,SAAL,CAAe1F,OAAf,CAAuB,UAACuH,QAAD;AAAA,eAAc,KAAIA,QAAJ,EAAc,CAAC7D,kBAAD,CAAd,CAAd;AAAA,OAAvB;AACD;;SAECC;WAAD,iBAAyB;AAAA;;AACxB,WAAKlH,QAAL,CAAcM,IAAd,CAAmB4G,oBAAnB;;AACA,UAAM+B,SAAS,sBAAO,KAAKA,SAAZ,CAAf;;AAEAA,MAAAA,SAAS,CACN8B,OADH,GAEGxH,OAFH,CAEW;AAAA;AAAA,YAAIuH,QAAJ;;AAAA,eAAkB,KAAIA,QAAJ,EAAc,CAAC5D,oBAAD,CAAd,CAAlB;AAAA,OAFX,EAJwB;;AASxBwC,MAAAA,YAAY,CAAC,KAAKmB,aAAN,CAAZ;AACA,WAAKA,aAAL,GAAqB9H,UAAU,CAAC,YAAM;AACpC,QAAA,MAAI,CAACkH,YAAL,CAAkB;AAChBlI,UAAAA,MAAM,EAAE;AADQ,SAAlB;AAGD,OAJ8B,EAI5B,IAJ4B,CAA/B;AAKD;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;WA0EA,kBAAS;AAAA;;AACP,yBAAyB,KAAK7B,KAA9B;AAAA,UAAQ0E,EAAR,gBAAQA,EAAR;AAAA,UAAe1E,KAAf;;AACA,wBAA+C,KAAKe,KAApD;AAAA,UAAQV,QAAR,eAAQA,QAAR;AAAA,UAAkBuG,WAAlB,eAAkBA,WAAlB;AAAA,UAA+BoD,GAA/B,eAA+BA,GAA/B;AAAA,UAAoCnI,MAApC,eAAoCA,MAApC;AAEA,0BACEL,6BAACW,QAAD;AAAQ,QAAA,MAAM,EAAEN,MAAhB;AAAA;AAAA,sBACEL;AACE,QAAA,GAAG,EAAE,aAAC2I,IAAD,EAAU;AACb,UAAA,MAAI,CAACC,OAAL,GAAeD,IAAf;AACD,SAHH;AAAA;AAAA,sBAKE3I;AAAK,QAAA,GAAG,EAAC,kBAAT;AAA0C,QAAA,SAAS,EAAC;AAApD,sBACEA,6BAAC,MAAD;AAAQ,QAAA,EAAE,EAAEkD,EAAZ;AAAgB,QAAA,WAAW,EAAEkC,WAA7B;AAAA;AAAA,sBACEpF,6BAAC,iBAAD;AAAmB,QAAA,KAAK,EAAE,KAAKsJ,YAA/B;AAAA;AAAA,SACGtJ,cAAK,CAACuJ,QAAN,CAAeC,GAAf,CAAmB3K,QAAnB,EAA6B,UAAC4K,KAAD,EAAQC,GAAR;AAAA,4BAC5B1J,cAAK,CAAC2J,YAAN,CAAmBF,KAAnB,EAA0B;AACxBjB,UAAAA,GAAG,YAAKiB,KAAK,CAACjB,GAAN,IAAa,EAAlB,cAAwBA,GAAxB,cAA+BkB,GAA/B;AADqB,SAA1B,CAD4B;AAAA,OAA7B,CADH,CADF,CADF,CALF,CADF,CADF;AAqBD;;;;EAvNiClK;;;ACVpC;AAQA,IAAMoK,gBAAgB,GAAG,MAAzB;AACA,IAAMC,mBAAmB,GAAG,SAA5B;;IAEqBC;;;;;;;;;;;;;;;;4DACX,IAAI9I,GAAJ;;4DACA,IAAIA,GAAJ;;8DACE,IAAIA,GAAJ;;2EAEa,UAAS,UAACkE,EAAD;AAAA,aAAQ,MAAK6E,WAAL,CAAiB7E,EAAjB,CAAR;AAAA,KAAT;;yEACF;;uEACF,UAACA,EAAD,EAAQ;AACzB,YAAK8E,kBAAL,CAAwB5I,IAAxB,CAA6B8D,EAA7B;;AACA,YAAK+E,oBAAL,CAA0B,YAAM;AAC9B,cAAKD,kBAAL,CAAwBnI,OAAxB,CAAgC,UAACqD,EAAD;AAAA,iBAAQ,KAAIA,EAAJ,CAAR;AAAA,SAAhC;;AACA,cAAK8E,kBAAL,GAA0B,EAA1B;AACD,OAHD;AAID;;6DACQ,UAAC9G,EAAD,EAAKgH,MAAL;AAAA,aACP,IAAI1J,OAAJ,CAAY,UAACC,OAAD,EAAa;AACvB,YAAM0J,MAAM,GAAG,MAAKlB,OAAL,CAAa9F,GAAb,CAAiBD,EAAjB,CAAf;;AACA,YAAMkH,KAAK,GAAG,CAACD,MAAf;AACA,YAAME,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;AACA,YAAM1B,IAAI,GAAG,MAAKT,KAAL,CAAW/E,GAAX,CAAeD,EAAf,KAAsB,IAAnC;;AACA,cAAKgF,KAAL,CAAW3E,GAAX,CAAeL,EAAf;AACEA,UAAAA,EAAE,EAAFA,EADF;AAEEqH,UAAAA,UAAU,EAAEF,GAFd;AAGEG,UAAAA,UAAU,EAAEH;AAHd,WAIK1B,IAJL,GAKKuB,MALL;;AAQA,YAAIE,KAAJ,EAAW;AACT,gBAAKjC,OAAL,sBAAoB,MAAKA,OAAzB;;AAEA,gBAAK4B,WAAL,CAAiBtJ,OAAjB;AACD,SAJD,MAIO;AACL,cAAQ5B,QAAR,GAAkCqL,MAAlC,CAAQrL,QAAR;AAAA,cAAkBuG,WAAlB,GAAkC8E,MAAlC,CAAkB9E,WAAlB;AACA+E,UAAAA,MAAM,CAAChL,QAAP,CAAgB;AAAEN,YAAAA,QAAQ,EAARA,QAAF;AAAYuG,YAAAA,WAAW,EAAXA;AAAZ,WAAhB,EAA2C3E,OAA3C;AACD;AACF,OArBD,CADO;AAAA;;2DAwBF,UAACyC,EAAD,EAAKgH,MAAL;AAAA,aACL,IAAI1J,OAAJ,CAAY,UAACC,OAAD,EAAa;AACvB,cAAKgK,MAAL,CAAYvH,EAAZ;AACEA,UAAAA,EAAE,EAAFA;AADF,WAEKgH,MAFL,GAGGQ,IAHH,CAGQ,YAAM;AACZjK,UAAAA,OAAO,CAAC,MAAKgH,KAAL,CAAWtE,GAAX,CAAeD,EAAf,CAAD,CAAP;AACD,SALD;AAMD,OAPD,CADK;AAAA;;4EAUiB,UAACyH,IAAD;AAAA,aACtB,MAAKC,eAAL,GAAuBC,MAAvB,CAA8B,UAAClC,IAAD;AAAA,eAC5BjL,QAAQ,CAACiN,IAAD,CAAR,GAAiBA,IAAI,CAACG,IAAL,CAAUnC,IAAI,CAACgC,IAAf,CAAjB,GAAwChC,IAAI,CAACgC,IAAL,KAAcA,IAD1B;AAAA,OAA9B,CADsB;AAAA;;kEAKV,UAACI,GAAD,EAAS;AACrB;AACA,UAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAAC9H,EAAD,EAAQ;AAChC,YAAMyE,YAAY,GAAG,KAAI,MAAKsD,QAAL,CAAc/H,EAAd,CAAJ,EAAuB,cAAvB,EAAuC,EAAvC,CAArB;;AAEA,YAAIyE,YAAY,CAACuD,IAAb,GAAoB,CAAxB,EAA2B;AACzB,iBAAO,CAAChI,EAAD,EAAK,mBAAIyE,YAAJ,EAAkB6B,GAAlB,CAAsBwB,iBAAtB,CAAL,CAAP;AACD;;AAED,gBAAQ9H,EAAR,4BAAeyE,YAAf;AACD,OARD;;AAUA,aAAO,SAAQoD,GAAG,CAACvB,GAAJ,CAAQ,UAACtG,EAAD;AAAA,eAAQ8H,iBAAiB,CAAC9H,EAAD,CAAzB;AAAA,OAAR,CAAR,CAAP;AACD;;+DAEU,UAACA,EAAD;AAAA;;AAAA,yCAAQiE,IAAR;AAAQA,QAAAA,IAAR;AAAA;;AAAA,aAAiB,iBAAKgE,WAAL,gBAAiB,CAACjI,EAAD,CAAjB,EAAuB0G,gBAAvB,SAA4CzC,IAA5C,EAAjB;AAAA;;qEACM,UAAC4D,GAAD;AAAA;;AAAA,yCAAS5D,IAAT;AAASA,QAAAA,IAAT;AAAA;;AAAA,aACf,iBAAKgE,WAAL,gBAAiB,MAAKC,WAAL,CAAiBL,GAAjB,CAAjB,EAAwCnB,gBAAxC,SAA6DzC,IAA7D,EADe;AAAA;;2DAGV,UAACwD,IAAD;AAAA;;AAAA,yCAAUxD,IAAV;AAAUA,QAAAA,IAAV;AAAA;;AAAA,aACL,iBAAKgE,WAAL,gBACE,MAAKE,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC,UAACb,IAAD;AAAA,eAAUA,IAAI,CAACzF,EAAf;AAAA,OAArC,CADF,EAEE0G,gBAFF,SAGKzC,IAHL,EADK;AAAA;;gEAOK,UAACwD,IAAD;AAAA;;AAAA,yCAAUxD,IAAV;AAAUA,QAAAA,IAAV;AAAA;;AAAA,aACV,iBAAKmE,cAAL,gBACE,MAAKD,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC;AAAA,YAAGtG,EAAH,QAAGA,EAAH;AAAA,eAAYA,EAAZ;AAAA,OAArC,CADF,SAEKiE,IAFL,EADU;AAAA;;kEAME,UAACjE,EAAD;AAAA;;AAAA,yCAAQiE,IAAR;AAAQA,QAAAA,IAAR;AAAA;;AAAA,aACZ,iBAAKgE,WAAL,gBAAiB,CAACjI,EAAD,CAAjB,EAAuB2G,mBAAvB,SAA+C1C,IAA/C,EADY;AAAA;;wEAEM,UAAC4D,GAAD;AAAA;;AAAA,yCAAS5D,IAAT;AAASA,QAAAA,IAAT;AAAA;;AAAA,aAClB,iBAAKgE,WAAL,gBAAiB,MAAKC,WAAL,CAAiBL,GAAjB,CAAjB,EAAwClB,mBAAxC,SAAgE1C,IAAhE,EADkB;AAAA;;8DAGV,UAACwD,IAAD;AAAA;;AAAA,yCAAUxD,IAAV;AAAUA,QAAAA,IAAV;AAAA;;AAAA,aACR,iBAAKgE,WAAL,gBACE,MAAKE,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC,UAACb,IAAD;AAAA,eAAUA,IAAI,CAACzF,EAAf;AAAA,OAArC,CADF,EAEE2G,mBAFF,SAGK1C,IAHL,EADQ;AAAA;;mEAOK,UAACwD,IAAD;AAAA;;AAAA,yCAAUxD,IAAV;AAAUA,QAAAA,IAAV;AAAA;;AAAA,aACb,iBAAKoE,iBAAL,gBACE,MAAKF,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC;AAAA,YAAGtG,EAAH,SAAGA,EAAH;AAAA,eAAYA,EAAZ;AAAA,OAArC,CADF,SAEKiE,IAFL,EADa;AAAA;;kEAMD,UAACqE,OAAD;AAAA,UAAU9J,IAAV,uEAAiBkI,gBAAjB;;AAAA,0CAAsCzC,IAAtC;AAAsCA,QAAAA,IAAtC;AAAA;;AAAA,aACZ,IAAI3G,OAAJ,CAAY,UAACC,OAAD,EAAa;AACvB,YAAMgL,aAAa,GAAG,EAAtB;AAEAD,QAAAA,OAAO,CAAC3J,OAAR,CAAgB,UAACqB,EAAD,EAAQ;AACtB,cAAMwE,KAAK,GAAG,MAAKD,KAAL,CAAWtE,GAAX,CAAeD,EAAf,CAAd;;AAEA,cAAI,CAACwE,KAAL,EAAY;AACV;AACD;;AAED,cAAMyC,MAAM,GAAG,MAAKlB,OAAL,CAAa9F,GAAb,CAAiBD,EAAjB,CAAf;;AACAuI,UAAAA,aAAa,CAACrK,IAAd,CAAmB+I,MAAnB;AACD,SATD;;AAWA,YAAIsB,aAAa,CAAC9I,MAAd,KAAyB,CAA7B,EAAgC;AAC9BlC,UAAAA,OAAO,CAAC,KAAD,CAAP;AACA;AACD;;AAEDD,QAAAA,OAAO,CAACkL,GAAR,CACED,aAAa,CAACjC,GAAd,CAAkB,UAACW,MAAD;AAAA,iBAAY,oBAAIA,MAAJ,EAAYzI,IAAZ,SAAqByF,IAArB,EAAZ;AAAA,SAAlB,CADF,EAEEuD,IAFF,CAEO,UAACiB,SAAD;AAAA,iBAAelL,OAAO,CAACkL,SAAS,CAAC3F,KAAV,CAAgB4F,OAAhB,CAAD,CAAtB;AAAA,SAFP;AAGD,OAtBD,CADY;AAAA;;4DAyBN;AAAA;;AAAA,0CAAIzE,IAAJ;AAAIA,QAAAA,IAAJ;AAAA;;AAAA,aACN,kBAAKgE,WAAL,iBACE,MAAKP,eAAL,GAAuBpB,GAAvB,CAA2B;AAAA,YAAGtG,EAAH,SAAGA,EAAH;AAAA,eAAYA,EAAZ;AAAA,OAA3B,CADF,EAEE0G,gBAFF,SAGKzC,IAHL,EADM;AAAA;;+DAOG,UAACjE,EAAD;AAAA,aAAQ,MAAKuE,KAAL,CAAWtE,GAAX,CAAeD,EAAf,CAAR;AAAA;;8DACD,UAACA,EAAD;AAAA,aAAQ,MAAKgF,KAAL,CAAW/E,GAAX,CAAeD,EAAf,CAAR;AAAA;;sEACQ;AAAA,gCAAU,MAAKgF,KAAL,CAAW2D,MAAX,EAAV;AAAA;;8DAGR;AACRC,MAAAA,IAAI,EAAE,MAAKA,IADH;AAERrB,MAAAA,MAAM,EAAE,MAAKA,MAFL;AAGR7E,MAAAA,IAAI,EAAE,MAAKA,IAHH;AAIRmG,MAAAA,SAAS,EAAE,MAAKA,SAJR;AAKRC,MAAAA,QAAQ,EAAE,MAAKA,QALP;AAMRV,MAAAA,cAAc,EAAE,MAAKA,cANb;AAORW,MAAAA,OAAO,EAAE,MAAKA,OAPN;AAQRC,MAAAA,YAAY,EAAE,MAAKA,YARX;AASRC,MAAAA,WAAW,EAAE,MAAKA,WATV;AAURZ,MAAAA,iBAAiB,EAAE,MAAKA,iBAVhB;AAWRH,MAAAA,WAAW,EAAE,MAAKA,WAXV;AAYRgB,MAAAA,KAAK,EAAE,MAAKA,KAZJ;AAaRnB,MAAAA,QAAQ,EAAE,MAAKA,QAbP;AAcRoB,MAAAA,OAAO,EAAE,MAAKA,OAdN;AAeRzB,MAAAA,eAAe,EAAE,MAAKA;AAfd;;;;;;;WAkBV,kBAAS;AAAA;;AACP,iCAA4B,KAAKpM,KAAjC,CAAQK,QAAR;AAAA,UAAQA,QAAR,qCAAmB,IAAnB;AAEA,0BACEmB,6BAACjC,oBAAD;AAAoB,QAAA,KAAK,EAAE,KAAKoK,OAAhC;AAAA;AAAA,SACGtJ,QADH,eAEEmB;AAAK,QAAA,KAAK,EAAE;AAAEsM,UAAAA,OAAO,EAAE;AAAX,SAAZ;AAAA;AAAA,SACG,mBAAI,KAAKpE,KAAL,CAAW2D,MAAX,EAAJ,EAAyBrC,GAAzB,CAA6B;AAAA,YAAG3K,QAAH,SAAGA,QAAH;AAAA,YAAgBL,KAAhB;;AAAA,4BAC5BwB,6BAAC,MAAD;AACE,UAAA,GAAG,EAAExB,KAAK,CAAC0E;AADb,WAEM1E,KAFN;AAGE,UAAA,KAAK,EAAE,OAHT;AAIE,UAAA,KAAK,EAAE,OAAI,CAACiJ,KAJd;AAKE,UAAA,OAAO,EAAE,OAAI,CAACwB,OALhB;AAME,UAAA,GAAG,EAAE,aAACkB,MAAD,EAAY;AACf,YAAA,OAAI,CAAClB,OAAL,CAAa1F,GAAb,CAAiB/E,KAAK,CAAC0E,EAAvB,EAA2BiH,MAA3B;AACD,WARH;AAAA;AAAA,YAUGtL,QAVH,CAD4B;AAAA,OAA7B,CADH,CAFF,CADF;AAqBD;;;;EAtLqCC;;AAyLxC,SAASyN,kBAAT,GAA8B;AAC5B,MAAI,CAAC,kBAAU,UAAV,CAAL,EAA4B;AAC1B;AACD;;AACD,MAAMC,SAAS,GAAG,kBAAU,wBAAV,EAAoC,KAApC,CAAlB,CAJ4B;;;AAM5B,MAAIC,QAAQ,CAACC,UAAb,EAAyBD,QAAQ,CAACC,UAAT,CAAoBF,SAApB,EAA+BvI,MAA/B,eAAsCjE,6BAAC,UAAD;AAAA;AAAA,IAAtC,EAAzB,KACKyM,QAAQ,CAACxI,MAAT,eAAgBjE,6BAAC,UAAD;AAAA;AAAA,IAAhB,EAAgCwM,SAAhC;AACN;;AACDD,kBAAkB;;;;;;;;ACpMlB,SAASI,oBAAT,CAA8BC,UAA9B,EAA0C;AACxC,MACEhH,IADF,GAOIgH,UAPJ,CACEhH,IADF;AAAA,MAEEmG,SAFF,GAOIa,UAPJ,CAEEb,SAFF;AAAA,MAGEE,OAHF,GAOIW,UAPJ,CAGEX,OAHF;AAAA,MAIEC,YAJF,GAOIU,UAPJ,CAIEV,YAJF;AAAA,MAKEE,KALF,GAOIQ,UAPJ,CAKER,KALF;AAAA,MAMExB,eANF,GAOIgC,UAPJ,CAMEhC,eANF;AAQA,SAAO;AAAEhF,IAAAA,IAAI,EAAJA,IAAF;AAAQmG,IAAAA,SAAS,EAATA,SAAR;AAAmBE,IAAAA,OAAO,EAAPA,OAAnB;AAA4BC,IAAAA,YAAY,EAAZA,YAA5B;AAA0CE,IAAAA,KAAK,EAALA,KAA1C;AAAiDxB,IAAAA,eAAe,EAAfA;AAAjD,GAAP;AACD;;AAED,AAAO,IAAMiC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,SAAD,EAAe;AAC5C,MAAMnJ,aAAa,GAAG,SAAhBA,aAAgB,OAAkC;AAAA,QAA/BoJ,QAA+B,QAA/BA,QAA+B;AAAA,QAArB5E,OAAqB,QAArBA,OAAqB;AAAA,QAAZ3J,KAAY,QAAZA,KAAY;;AACtD,QAAMwO,mBAAmB,GAAG,aAAY7E,OAAZ,CAA5B;;AAEA,QAAI6E,mBAAJ,EAAyB;AACvBzK,MAAAA,OAAO,CAACuC,KAAR,CAAc,yDAAd;AACD;;AAED,WAAOkI,mBAAmB,GACxB,KAAIxO,KAAJ,EAAW,UAAX,EAAuB,IAAvB,CADwB,gBAGxBwB,6BAAC,OAAD;AAAS,MAAA,MAAM,EAAE+M,QAAjB;AAA2B,MAAA,GAAG,EAAEvO,KAAK,CAACyO,GAAtC;AAAA;AAAA,OACG,UAAC/J,EAAD;AAAA,0BACClD,6BAAC,QAAD;AAAU,QAAA,GAAG,EAAEkD,EAAf;AAAmB,QAAA,EAAE,EAAEA,EAAvB;AAAA;AAAA,SACG,UAACkC,WAAD;AAAA,4BACCpF,6BAAC,SAAD;AACE,UAAA,GAAG,EAAEkD;AADP,WAEM1E,KAFN,EAGM4G,WAHN;AAIE,UAAA,EAAE,EAAElC,EAJN;AAKE,UAAA,QAAQ,EAAEiF,OALZ;AAAA;AAAA,WADD;AAAA,OADH,CADD;AAAA,KADH,CAHF;AAmBD,GA1BD;;AA2BA,MAAM+E,UAAU,GAAG,SAAbA,UAAa;AAAA,QAAOH,QAAP,SAAG7J,EAAH;AAAA,QAAoB1E,KAApB;;AAAA,WACjBmF,aAAa,CAAC;AAAEoJ,MAAAA,QAAQ,EAARA,QAAF;AAAY5E,MAAAA,OAAO,EAAE1I,eAAe,EAApC;AAAwCjB,MAAAA,KAAK,EAALA;AAAxC,KAAD,CADI;AAAA,GAAnB;;AAGA,MAAM2O,UAAU,GAAG,SAAbA,UAAa;AAAA,QAAOJ,QAAP,SAAG7J,EAAH;AAAA,QAAoB1E,KAApB;;AAAA,wBACjBwB,6BAAC/B,oBAAD;AAAA;AAAA,OACG,UAACkK,OAAD;AAAA,aAAaxE,aAAa,CAAC;AAAEoJ,QAAAA,QAAQ,EAARA,QAAF;AAAY5E,QAAAA,OAAO,EAAPA,OAAZ;AAAqB3J,QAAAA,KAAK,EAALA;AAArB,OAAD,CAA1B;AAAA,KADH,CADiB;AAAA,GAAnB;;AAMA,SAAO,YAAWkB,gBAAX,IAAyBwN,UAAzB,GAAsCC,UAA7C;AACD,CAtCM;;AAwCP,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAC1H,gBAAD,EAAsB;AAC3C,MAAM/B,aAAa,GAAG,SAAhBA,aAAgB;AAAA,QAAGwE,OAAH,SAAGA,OAAH;AAAA,QAAY3J,KAAZ,SAAYA,KAAZ;AAAA,QAAmBqH,YAAnB,SAAmBA,YAAnB;AAAA,wBACpB7F,6BAAC,gBAAD,eAAsBxB,KAAtB,EAAiC2J,OAAjC;AAA0C,MAAA,GAAG,EAAEtC,YAA/C;AAAA;AAAA,OADoB;AAAA,GAAtB;;AAIA,MAAMwH,SAAS,GAAG,SAAZA,SAAY;AAAA,QAAGxH,YAAH,SAAGA,YAAH;AAAA,QAAoBrH,KAApB;;AAAA,WAChBmF,aAAa,CAAC;AACZwE,MAAAA,OAAO,EAAEwE,oBAAoB,CAAClN,eAAe,MAAM,EAAtB,CADjB;AAEZjB,MAAAA,KAAK,EAALA,KAFY;AAGZqH,MAAAA,YAAY,EAAZA;AAHY,KAAD,CADG;AAAA,GAAlB;;AAOA,MAAMyH,SAAS,GAAG,SAAZA,SAAY;AAAA,QAAGzH,YAAH,SAAGA,YAAH;AAAA,QAAoBrH,KAApB;;AAAA,wBAChBwB,6BAAC/B,oBAAD;AAAA;AAAA,OACG;AAAA,UAAC2O,UAAD,uEAAc,EAAd;AAAA,aACCjJ,aAAa,CAAC;AACZwE,QAAAA,OAAO,EAAEwE,oBAAoB,CAACC,UAAD,CADjB;AAEZpO,QAAAA,KAAK,EAALA,KAFY;AAGZqH,QAAAA,YAAY,EAAZA;AAHY,OAAD,CADd;AAAA,KADH,CADgB;AAAA,GAAlB;;AAYA,MAAM0H,iBAAiB,GAAG,YAAW7N,gBAAX,IAAyB2N,SAAzB,GAAqCC,SAA/D;;AAEA,MAAI,YAAW/G,gBAAX,CAAJ,EAA4B;AAC1B,QAAMC,eAAe,gBAAGD,gBAAU,CAAC,UAAC/H,KAAD,EAAQuH,GAAR;AAAA,0BACjC/F,6BAAC,iBAAD,eAAuBxB,KAAvB;AAA8B,QAAA,YAAY,EAAEuH,GAA5C;AAAA;AAAA,SADiC;AAAA,KAAD,CAAlC;AAIA,WAAOU,YAAY,CAACD,eAAD,EAAkBd,gBAAlB,CAAnB;AACD,GAND,MAMO;AACL,WAAOe,YAAY,CAAC8G,iBAAD,EAAoB7H,gBAApB,CAAnB;AACD;AACF,CAnCD;;AAqCA,IAAa8H,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AACtC,MAAI,CAAC,YAAW9N,gBAAX,CAAL,EAA6B;AAC3B,WAAO,EAAP;AACD;;AAED,MAAMkD,QAAQ,GAAGnD,eAAe,EAAhC;;AAEA,MAAI,CAACmD,QAAL,EAAe;AACb,WAAO,EAAP;AACD;;AAED,SAAO+J,oBAAoB,CAAC/J,QAAD,CAA3B;AACD,CAZM;;ACxFP,SAAS6K,gBAAT,GAAqC;AAAA,MAAX9E,IAAW,uEAAJ,EAAI;;AACnC,MAAI,CAAC,SAAQA,IAAR,CAAL,EAAoB;AAClB,WAAO,KAAP;AACD;;AAED,SACEA,IAAI,CAAC+E,WAAL,GAAmB/E,IAAI,CAACgF,WAAxB,IAAuChF,IAAI,CAACiF,YAAL,GAAoBjF,IAAI,CAACkF,YADlE;AAGD;;AAED,SAASC,kBAAT,CAA4BC,IAA5B,EAAkC;AAChC,MAAI,CAAC,YAAW,kBAAU,2BAAV,CAAX,CAAL,EAAyD;AACvD,WAAO,EAAP;AACD;;AAED,SAAO,6BAAI,OAAM,KAAIA,IAAJ,EAAU,kBAAV,EAA8B,GAA9B,CAAN,EAA0C,EAA1C,CAAJ,IAAmDA,IAAnD,GAAyDlD,MAAzD,CACL4C,gBADK,CAAP;AAGD;;AAED,AAAe,SAASO,kBAAT,CAA4BD,IAA5B,EAAkC;AAC/C,MAAM7F,KAAK,sBAAO,IAAIN,GAAJ,oBAAY,SAAQmG,IAAI,CAACvE,GAAL,CAASsE,kBAAT,CAAR,CAAZ,EAAP,CAAX;;AAEA,MAAMG,KAAK,GAAG/F,KAAK,CAACsB,GAAN,CAAU,UAACb,IAAD;AAAA,WAAU,CAChCA,IADgC,EAEhC;AACEuF,MAAAA,CAAC,EAAEvF,IAAI,CAACwF,UADV;AAEEC,MAAAA,CAAC,EAAEzF,IAAI,CAAC0F;AAFV,KAFgC,CAAV;AAAA,GAAV,CAAd;AAQA,SAAO,SAASC,MAAT,GAAkB;AACvBL,IAAAA,KAAK,CAACpM,OAAN,CAAc,gBAAsB;AAAA;AAAA,UAApB8G,IAAoB;AAAA;AAAA,UAAZuF,CAAY,UAAZA,CAAY;AAAA,UAATE,CAAS,UAATA,CAAS;;AAClCzF,MAAAA,IAAI,CAACwF,UAAL,GAAkBD,CAAlB;AACAvF,MAAAA,IAAI,CAAC0F,SAAL,GAAiBD,CAAjB;AACD,KAHD;AAID,GALD;AAMD;;;;AC/CD;AAqBA,IAAMG,IAAI,GAAG,kBAAU,eAAV,CAAb;;AACA,IAAMC,sBAAsB,GAAG,kBAE7B,2BAF6B,EAG7B,kBAAU,0BAAV,EAAsC,EAAtC,CAH6B,CAA/B;;AAMA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAAC9D,IAAD;AAAA,8BAEjBA,IAAI,oBAAYA,IAAZ,WAAuB,EAFV;AAAA,CAArB;;AAOA,IAAM+D,eAAe,GAAG,SAAlBA,eAAkB,CAACC,GAAD,EAAS;AAC/B,MAAI,SAAQA,GAAR,CAAJ,EAAkB;AAChB,WAAOA,GAAP;AACD;;AAED,SAAO,CAACA,GAAD,CAAP;AACD,CAND;;IAQM7B;;;;;AAIJ;AAsBU;AACS;AAEnB,qBAAYtO,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,kEAxBL,CAwBK;;AAAA,gEAvBP,UAAS,YAAM;AACzB,UAAQmM,IAAR,GAAiB,MAAKnM,KAAtB,CAAQmM,IAAR;AACApI,MAAAA,OAAO,CAACuC,KAAR,CAAc2J,YAAY,CAAC9D,IAAD,CAA1B;AACD,KAHW,EAGT,GAHS,CAuBO;;AAAA,yEAnBE,UAAS,YAAM;AAClC,YAAKiE,WAAL,GAAmB,CAAnB;AACD,KAFoB,EAElB,EAFkB,CAmBF;;AAAA,0EAhBG,YAAM;AAC1B,UAAMC,mBAAmB,GAAG,MAAKD,WAAL,GAAmB,EAA/C;;AAEA,UAAIC,mBAAJ,EAAyB;AACvB,cAAKC,SAAL;AACD;;AAED,YAAKF,WAAL;;AACA,YAAKG,kBAAL;;AAEA,aAAOF,mBAAP;AACD,KAKkB;;AAAA,yDAHd,IAGc;;AAAA,kEAFL,IAEK;;AAAA,6DADV,KACU;;AAAA,6DAkCV,YAAwB;AAAA,UAAvBG,WAAuB,uEAAT,IAAS;AAC/B,wBAA6C,MAAKxQ,KAAlD;AAAA,UAAQ0E,EAAR,eAAQA,EAAR;AAAA,UAAY8K,kBAAZ,eAAYA,kBAAZ;AAAA,UAAgCiB,QAAhC,eAAgCA,QAAhC;;AACA,UAAMvH,KAAK,GAAGuH,QAAQ,CAAChE,QAAT,CAAkB/H,EAAlB,CAAd,CAF+B;;;AAI/B,UAAI;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAwE,QAAAA,KAAK,CAACQ,KAAN,CAAYrG,OAAZ,CAAoB,UAAC8G,IAAD,EAAU;AAC5B,gBAAK/H,WAAL,CAAiBsI,WAAjB,CAA6BP,IAA7B;AACD,SAFD;;AAIA,YAAIqG,WAAW,IAAIhB,kBAAnB,EAAuC;AACrC;AACA,eAAItG,KAAK,CAACwH,eAAV;AACD;AACF,OAnBD,CAmBE,OAAOpK,KAAP,EAAc;AAEf;AACF,KA5DkB;;AAAA,4DA+DX,YAA2B;AAAA,UAA1BqK,cAA0B,uEAAT,IAAS;AACjC,yBAAyB,MAAK3Q,KAA9B;AAAA,UAAQ0E,EAAR,gBAAQA,EAAR;AAAA,UAAY+L,QAAZ,gBAAYA,QAAZ;;AACA,UAAMvH,KAAK,GAAGuH,QAAQ,CAAChE,QAAT,CAAkB/H,EAAlB,CAAd;;AACA,UAAMkM,6BAA6B,GAAG,SACpC,SAAQ,CAAC,MAAK5Q,KAAL,CAAWwP,kBAAZ,CAAR,EAAyCxE,GAAzC,CAA6C,UAAC6F,IAAD,EAAU;AACrD,YAAIA,IAAI,KAAK,IAAb,EAAmB;AACjB,iBAAO3H,KAAK,CAACQ,KAAb;AACD;;AAED,YAAImH,IAAI,KAAK,QAAb,EAAuB;AACrB,iBAAO,CAACb,sBAAD,EAAyBD,IAAzB,CAAP;AACD;;AAED,kCAAW,OAAM,kBAAU,2BAAV,EAAuCc,IAAvC,CAAN,EAAoD,EAApD,CAAX;AACD,OAVD,CADoC,EAYpCxE,MAZoC,CAY7Be,OAZ6B,CAAtC,CAHiC;;;AAkBjC,UAAI;AACF,YAAIuD,cAAc,IAAIC,6BAA6B,CAACzM,MAA9B,GAAuC,CAA7D,EAAgE;AAC9D;AACA+E,UAAAA,KAAK,CAACwH,eAAN,GAAwBlB,kBAAkB,CACxCoB,6BADwC,CAA1C;AAGD,SANC;AASF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA1H,QAAAA,KAAK,CAACQ,KAAN,CAAYrG,OAAZ,CAAoB,UAAC8G,IAAD,EAAU;AAC5B,cAAIwG,cAAJ,EAAoB;AAClB,kBAAKvO,WAAL,CAAiB0O,WAAjB,CAA6B3G,IAA7B;AACD,WAFD,MAEO;AACLjB,YAAAA,KAAK,CAACkB,OAAN,CAAcM,WAAd,CAA0BP,IAA1B;AACD;AACF,SAND;AAOD,OA7BD,CA6BE,OAAO7D,KAAP,EAAc;AAEf;AACF,KAjHkB;;AAAA,2DAmHZ,YAAM;AACX,yBAA4C,MAAKtG,KAAjD;AAAA,UAAQyQ,QAAR,gBAAQA,QAAR;AAAA,UAAkB/L,EAAlB,gBAAkBA,EAAlB;AAAA,UAAsBrE,QAAtB,gBAAsBA,QAAtB;AAAA,UAAmCsI,IAAnC,uDADW;;;AAIX8H,MAAAA,QAAQ,CACLnD,IADH,CACQ5I,EADR;AAEIrE,QAAAA,QAAQ,EAARA,QAFJ;AAGI0Q,QAAAA,WAAW,EAAE;AAAA;AAAA;AAHjB,SAIOpI,IAJP,GAMGuD,IANH,CAMQ,UAAChD,KAAD,EAAW;AACf;AACA,YAAI,CAACA,KAAL,EAAY;AACV;AACD;;AAED,cAAK8H,MAAL,GANe;;;AASf,YAAI9H,KAAK,CAACqB,MAAV,EAAkB;AAChB,8CAAUxD,kBAAV;AACD,SAFD,MAEO;AACLmC,UAAAA,KAAK,CAACqB,MAAN,GAAe,IAAf;AACD;;AACD,cAAKC,MAAL,GAAc,KAAd;AACD,OArBH;AAsBD,KA7IkB;;AAAA,6DA+IV,YAA0C;AAAA,qFAAP,EAAO;AAAA,UAAvCiG,QAAuC,QAAvCA,QAAuC;AAAA,UAA7B/L,EAA6B,QAA7BA,EAA6B;AAAA,UAAzByH,IAAyB,QAAzBA,IAAyB;AAAA,UAAhBxD,IAAgB;;AACjD,UAAI,CAAC8H,QAAD,IAAa,MAAKjG,MAAlB,IAA4B,MAAK6F,mBAAL,CAAyBlE,IAAzB,CAAhC,EAAgE;AAC9D;AACD,OAHgD;AAMjD;AACA;AACA;;;AACAsE,MAAAA,QAAQ,CAACxE,MAAT,CAAgBvH,EAAhB;AACEyH,QAAAA,IAAI,EAAJA,IADF;AAEE4E,QAAAA,WAAW,EAAE;AAAA;AAAA;AAFf,SAGKpI,IAHL,GATiD;;AAelD,KA9JkB;;AAEjB,UAAKjE,EAAL,GAAU1E,KAAK,CAAC0E,EAAhB;;AACA,UAAKuM,IAAL;AAAA;;AAGC,KAAClK,kBAAD,EAAqBC,oBAArB,EAA2C3D,OAA3C,CAAmD,UAACoE,aAAD,EAAmB;AACrE,YAAKA,aAAL,IAAsB,YAAM;AAC1B,2BAAyB,MAAKzH,KAA9B;AAAA,YAAQ0E,EAAR,gBAAQA,EAAR;AAAA,YAAY+L,QAAZ,gBAAYA,QAAZ;;AACA,YAAMvH,KAAK,GAAGuH,QAAQ,CAAChE,QAAT,CAAkB/H,EAAlB,CAAd;;AACA,YAAMyF,IAAI,GAAGsG,QAAQ,CAAC5C,OAAT,CAAiBnJ,EAAjB,CAAb;;AACA,YAAIyF,IAAI,IAAI1C,aAAa,KAAKV,kBAA9B,EAAkD;AAChDoD,UAAAA,IAAI,CAAC6B,UAAL,GAAkBF,IAAI,CAACD,GAAL,EAAlB;AACD;;AAED,YAAMrB,MAAM,GAAG/C,aAAa,KAAKT,oBAAjC,CAR0B;;AAW1B,YAAI,CAACkC,KAAD,IAAUA,KAAK,CAACO,QAApB,EAA8B;AAC5B;AACA,cAAI,MAAKe,MAAL,IAAe,CAACA,MAApB,EAA4B;AAC1B,kBAAKyG,IAAL;AACD;;AACD;AACD;;AAED,aAAI/H,KAAJ,EAAWzB,aAAX;;AACAyB,QAAAA,KAAK,CAACsB,MAAN,GAAeA,MAAf;AACA,cAAKA,MAAL,GAAcA,MAAd;AACD,OAtBD;AAuBD,KAxBA;AANgB;AA+BlB;;;;;;AAkID,mCAAsBrK,SAAtB,EAAiC;AAC/B,WAAK8L,MAAL,CAAY9L,SAAZ;AAEA,aAAO,KAAP;AACD;;;;WAGD,gCAAuB;AACrB,yBAAgD,KAAKH,KAArD;AAAA,UAAQ0E,EAAR,gBAAQA,EAAR;AAAA,UAAY+L,QAAZ,gBAAYA,QAAZ;AAAA,2CAAsBS,IAAtB;AAAA,UAA4BC,QAA5B,kCAAuC,IAAvC;;AACA,UAAMjI,KAAK,GAAGuH,QAAQ,CAAChE,QAAT,CAAkB/H,EAAlB,CAAd;;AACA,6BAAwBwL,eAAe,CAAC,KAAIiB,QAAJ,CAAD,CAAvC;AAAA;AAAA,UAAOD,IAAP;AAAA,UAAaE,OAAb;;AAEA,UAAI,CAAClI,KAAL,EAAY;AACV;AACD;;AAED,WAAKmI,KAAL;AACA,aAAOnI,KAAK,CAAC6H,WAAb;;AAEA,UAAI,CAACG,IAAL,EAAW;AACT,YAAIE,OAAJ,EAAa;AACX,cAAME,UAAU,GAAG,CACjBpI,KADiB,4BAEduH,QAAQ,CAAC7D,WAAT,CAAqB,CAAClI,EAAD,CAArB,EAA2BsG,GAA3B,CAA+B,UAACtG,EAAD;AAAA,mBAAQ+L,QAAQ,CAAChE,QAAT,CAAkB/H,EAAlB,CAAR;AAAA,WAA/B,CAFc,GAGjB2H,MAHiB,CAGVe,OAHU,CAAnB;AAKAkE,UAAAA,UAAU,CAACjO,OAAX,CAAmB,UAAC6F,KAAD,EAAW;AAC5BA,YAAAA,KAAK,CAACO,QAAN,GAAiB,IAAjB;AACD,WAFD;;AAGA,oBAAS;AAAA,mBAAMgH,QAAQ,CAAC3D,cAAT,CAAwB,CAACpI,EAAD,CAAxB,CAAN;AAAA,WAAT;AACD,SAVD,MAUO;AACLwE,UAAAA,KAAK,CAACO,QAAN,GAAiB,IAAjB;;AACA,oBAAS;AAAA,mBAAMgH,QAAQ,CAACjD,QAAT,CAAkB9I,EAAlB,CAAN;AAAA,WAAT;AACD;AACF,OA3BoB;;;AA8BrB,WAAI,IAAJ,EAAUsC,oBAAV;AACD;;;WAED,kBAAS;AAAA;;AACP,0BACExF;AACE,QAAA,GAAG,EAAC,wBADN;AAGE,QAAA,SAAS,EAAC,YAHZ;AAIE,QAAA,GAAG,EAAE,aAAC2I,IAAD,EAAU;AACb,UAAA,MAAI,CAAC/H,WAAL,GAAmB+H,IAAnB;AACD;AANH,QADF;AAUD;;;;EAjPqB7J;;;gBAAlBgO,2BACkB;AACpBkB,EAAAA,kBAAkB,EAAE;AADA;;AAoPxB,SAAS+B,YAAT,QAAoC;AAAA,MAAZlR,QAAY,SAAZA,QAAY;AAClC,sBACEmB;AAAK,IAAA,GAAG,EAAC,wBAAT;AAAgD,IAAA,SAAS,EAAC;AAA1D,kBACEA;AAAK,IAAA,GAAG,EAAC,kBAAT;AAA0C,IAAA,SAAS,EAAC;AAApD,KACGnB,QADH,CADF,CADF;AAOD;;AAED,kBAAe,YAAW,kBAAU,yBAAV,CAAX,IACXgO,eAAe,CAACpH,cAAc,CAACqH,SAAD,CAAf,CADJ,GAEXiD,YAFJ;;;;;;;;;;;;;;;"}